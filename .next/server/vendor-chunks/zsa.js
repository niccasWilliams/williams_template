"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/zsa";
exports.ids = ["vendor-chunks/zsa"];
exports.modules = {

/***/ "(action-browser)/./node_modules/zsa/dist/index.mjs":
/*!*****************************************!*\
  !*** ./node_modules/zsa/dist/index.mjs ***!
  \*****************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CompleteProcedure: () => (/* binding */ CompleteProcedure),\n/* harmony export */   DefaultOmitted: () => (/* binding */ DefaultOmitted),\n/* harmony export */   ShapeErrorNotSet: () => (/* binding */ ShapeErrorNotSet),\n/* harmony export */   TOptsSource: () => (/* binding */ TOptsSource),\n/* harmony export */   ZSAError: () => (/* binding */ ZSAError),\n/* harmony export */   ZSAResponseMeta: () => (/* binding */ ZSAResponseMeta),\n/* harmony export */   ZodSafeFunction: () => (/* binding */ ZodSafeFunction),\n/* harmony export */   addToNullishArray: () => (/* binding */ addToNullishArray),\n/* harmony export */   canDataBeUndefinedForSchema: () => (/* binding */ canDataBeUndefinedForSchema),\n/* harmony export */   chainServerActionProcedures: () => (/* binding */ chainServerActionProcedures),\n/* harmony export */   createServerAction: () => (/* binding */ createServerAction),\n/* harmony export */   createServerActionProcedure: () => (/* binding */ createServerActionProcedure),\n/* harmony export */   createZodSafeFunction: () => (/* binding */ createZodSafeFunction),\n/* harmony export */   formDataToJson: () => (/* binding */ formDataToJson),\n/* harmony export */   instanceofZodTypeArray: () => (/* binding */ instanceofZodTypeArray),\n/* harmony export */   instanceofZodTypeBoolean: () => (/* binding */ instanceofZodTypeBoolean),\n/* harmony export */   instanceofZodTypeKind: () => (/* binding */ instanceofZodTypeKind),\n/* harmony export */   instanceofZodTypeLikeVoid: () => (/* binding */ instanceofZodTypeLikeVoid),\n/* harmony export */   instanceofZodTypeObject: () => (/* binding */ instanceofZodTypeObject),\n/* harmony export */   isKeyABooleanInZodSchema: () => (/* binding */ isKeyABooleanInZodSchema),\n/* harmony export */   isKeyAnArrayInZodSchema: () => (/* binding */ isKeyAnArrayInZodSchema),\n/* harmony export */   mergeArraysAndRemoveDuplicates: () => (/* binding */ mergeArraysAndRemoveDuplicates),\n/* harmony export */   unwrapZodType: () => (/* binding */ unwrapZodType)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(action-browser)/./node_modules/zod/lib/index.mjs\");\n// src/errors.ts\nvar ERROR_CODES = {\n  INPUT_PARSE_ERROR: \"INPUT_PARSE_ERROR\",\n  OUTPUT_PARSE_ERROR: \"OUTPUT_PARSE_ERROR\",\n  ERROR: \"ERROR\",\n  NOT_AUTHORIZED: \"NOT_AUTHORIZED\",\n  TIMEOUT: \"TIMEOUT\",\n  INTERNAL_SERVER_ERROR: \"INTERNAL_SERVER_ERROR\",\n  FORBIDDEN: \"FORBIDDEN\",\n  NOT_FOUND: \"NOT_FOUND\",\n  CONFLICT: \"CONFLICT\",\n  PRECONDITION_FAILED: \"PRECONDITION_FAILED\",\n  PAYLOAD_TOO_LARGE: \"PAYLOAD_TOO_LARGE\",\n  METHOD_NOT_SUPPORTED: \"METHOD_NOT_SUPPORTED\",\n  UNPROCESSABLE_CONTENT: \"UNPROCESSABLE_CONTENT\",\n  TOO_MANY_REQUESTS: \"TOO_MANY_REQUESTS\",\n  CLIENT_CLOSED_REQUEST: \"CLIENT_CLOSED_REQUEST\",\n  INSUFFICIENT_CREDITS: \"INSUFFICIENT_CREDITS\",\n  PAYMENT_REQUIRED: \"PAYMENT_REQUIRED\"\n};\nvar ZSAError = class extends Error {\n  /** the Error object thrown */\n  data;\n  /** the error code */\n  code;\n  inputParseErrors;\n  outputParseErrors;\n  constructor(code = ERROR_CODES.ERROR, data, more) {\n    super();\n    this.data = data;\n    this.code = code;\n    if (data instanceof Error) {\n      this.message = data.message;\n      this.stack = data.stack;\n      this.name = data.name;\n      this.cause = data.cause;\n    }\n    if (!this.message && typeof this.data === \"string\") {\n      this.message = this.data;\n    }\n    this.inputParseErrors = more?.inputParseErrors;\n    this.outputParseErrors = more?.outputParseErrors;\n  }\n};\n\n// src/utils.ts\n\nvar instanceofZodTypeKind = (type, zodTypeKind) => {\n  return type?._def?.typeName === zodTypeKind;\n};\nvar unwrapZodType = (type, unwrapPreprocess) => {\n  if (instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodOptional)) {\n    return unwrapZodType(type.unwrap(), unwrapPreprocess);\n  }\n  if (instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodDefault)) {\n    return unwrapZodType(type.removeDefault(), unwrapPreprocess);\n  }\n  if (instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodLazy)) {\n    return unwrapZodType(type._def.getter(), unwrapPreprocess);\n  }\n  if (instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodEffects)) {\n    if (type._def.effect.type === \"refinement\") {\n      return unwrapZodType(type._def.schema, unwrapPreprocess);\n    }\n    if (type._def.effect.type === \"transform\") {\n      return unwrapZodType(type._def.schema, unwrapPreprocess);\n    }\n    if (unwrapPreprocess && type._def.effect.type === \"preprocess\") {\n      return unwrapZodType(type._def.schema, unwrapPreprocess);\n    }\n  }\n  return type;\n};\nvar instanceofZodTypeObject = (type) => {\n  return instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodObject);\n};\nvar instanceofZodTypeArray = (type) => {\n  return instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodArray);\n};\nvar instanceofZodTypeBoolean = (type) => {\n  return instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodBoolean);\n};\nvar unwrapKeyInZodSchema = (key, schema) => {\n  const unwrapped = unwrapZodType(schema, true);\n  const isObject = instanceofZodTypeObject(unwrapped);\n  if (!isObject)\n    return null;\n  const shape = unwrapped.shape;\n  if (!(key in shape))\n    return null;\n  const value = shape[key];\n  if (!value)\n    return null;\n  return unwrapZodType(value, true);\n};\nvar isKeyAnArrayInZodSchema = (key, schema) => {\n  const unwrappedValue = unwrapKeyInZodSchema(key, schema);\n  if (unwrappedValue === null)\n    return false;\n  const isArray = instanceofZodTypeArray(unwrappedValue);\n  return isArray;\n};\nvar isKeyABooleanInZodSchema = (key, schema) => {\n  const unwrappedValue = unwrapKeyInZodSchema(key, schema);\n  if (unwrappedValue === null)\n    return false;\n  const isArray = instanceofZodTypeBoolean(unwrappedValue);\n  return isArray;\n};\nvar formDataToJson = (formData, inputSchema) => {\n  const json = {};\n  formData.forEach((value, key) => {\n    const isArraySchema = isKeyAnArrayInZodSchema(key, inputSchema);\n    const isBooleanSchema = isKeyABooleanInZodSchema(key, inputSchema);\n    if (!Reflect.has(json, key)) {\n      json[key] = isArraySchema ? [value] : value;\n      if (isBooleanSchema) {\n        if (json[key] === \"true\")\n          json[key] = true;\n        if (json[key] === \"false\")\n          json[key] = false;\n      }\n      return;\n    }\n    if (!Array.isArray(json[key])) {\n      json[key] = [json[key]];\n    }\n    json[key].push(value);\n  });\n  return json;\n};\nvar addToNullishArray = (array, value) => {\n  if (!array && !value)\n    return void 0;\n  if (!value)\n    return array;\n  const temp = [...array || []];\n  temp.push(value);\n  return temp;\n};\nvar mergeArraysAndRemoveDuplicates = (array1, array2) => {\n  if (!array1 && !array2)\n    return void 0;\n  if (!array2)\n    return array1;\n  if (!array1)\n    return array2;\n  const temp = [...array1 || [], ...array2 || []];\n  return [...new Set(temp)];\n};\nvar instanceofZodTypeLikeVoid = (type) => {\n  return instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodVoid) || instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodUndefined) || instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodNever);\n};\nvar canDataBeUndefinedForSchema = (schema) => {\n  if (!schema)\n    return true;\n  if (instanceofZodTypeLikeVoid(schema))\n    return true;\n  if (instanceofZodTypeKind(schema, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodOptional)) {\n    return true;\n  }\n  if (instanceofZodTypeKind(schema, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodDefault)) {\n    return true;\n  }\n  if (instanceofZodTypeKind(schema, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodLazy)) {\n    return canDataBeUndefinedForSchema(schema._def.getter());\n  }\n  if (instanceofZodTypeKind(schema, zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodFirstPartyTypeKind.ZodEffects)) {\n    if (schema._def.effect.type === \"refinement\") {\n      return canDataBeUndefinedForSchema(schema._def.schema);\n    }\n    if (schema._def.effect.type === \"transform\") {\n      return canDataBeUndefinedForSchema(schema._def.schema);\n    }\n    if (schema._def.effect.type === \"preprocess\") {\n      return canDataBeUndefinedForSchema(schema._def.schema);\n    }\n  }\n  return false;\n};\n\n// src/zod-safe-function.ts\n\n\n// src/types.ts\nvar TOptsSource = class {\n  validate;\n  constructor(validate) {\n    this.validate = validate;\n  }\n};\nvar DefaultOmitted = {\n  $internals: 1,\n  handleError: 1,\n  onInputParseError: 1,\n  getTimeoutErrorPromise: 1,\n  getProcedureChainOutput: 1,\n  handleSuccess: 1,\n  handleStart: 1,\n  parseInputData: 1,\n  parseOutputData: 1,\n  onOutputParseError: 1,\n  checkTimeoutStatus: 1,\n  getRetryDelay: 1,\n  evaluateInputSchema: 1,\n  getFinalStaticInputSchema: 1\n};\nvar ZSAResponseMeta = class {\n  /**\n   * the headers of the response\n   */\n  headers;\n  /**\n   * the status code of the response\n   *\n   * @default 200\n   */\n  statusCode;\n  constructor() {\n    this.statusCode = 200;\n    this.headers = new Headers();\n  }\n};\nvar ShapeErrorNotSet = \"ShapeErrorNotSet\";\n\n// src/zod-safe-function.ts\nvar validateOpts = (opts) => {\n  if (opts && (!(opts.source instanceof TOptsSource) || !opts.source.validate())) {\n    throw new Error(\"Invalid opts, must originate from the server\");\n  }\n};\nvar ZodSafeFunction = class _ZodSafeFunction {\n  /** The internals of the Zod Safe Function */\n  $internals;\n  constructor(internals) {\n    this.$internals = internals;\n  }\n  /** Check if the timeout has triggered, if so, throw a ZSAError */\n  checkTimeoutStatus(timeoutStatus) {\n    if (timeoutStatus.isTimeout) {\n      throw new ZSAError(\n        \"TIMEOUT\",\n        `Exceeded timeout of ${this.$internals.timeout} ms`\n      );\n    }\n  }\n  /**\n   *\n   * Get the retry delay for the current retry attempt\n   *\n   * If there should be no retry, returns -1\n   */\n  getRetryDelay($err, currentAttempt) {\n    try {\n      const err = $err instanceof ZSAError ? $err : new ZSAError(\"ERROR\", $err);\n      if (err.code === \"TIMEOUT\") {\n        return -1;\n      }\n      const config = this.$internals.retryConfig;\n      if (!config)\n        return -1;\n      if (this.$internals.isProcedure)\n        return -1;\n      const shouldRetry = currentAttempt < config.maxAttempts;\n      let retryDelay = 0;\n      if (typeof config.delay === \"function\") {\n        retryDelay = config.delay(currentAttempt, err);\n      } else if (typeof config.delay === \"number\") {\n        retryDelay = config.delay;\n      }\n      if (shouldRetry)\n        return retryDelay;\n      return -1;\n    } catch {\n      return -1;\n    }\n  }\n  /**\n   *  Run through the procedure chain and get the final context\n   */\n  async getProcedureChainOutput($args) {\n    const {\n      args,\n      timeoutStatus,\n      request,\n      responseMeta,\n      onInputSchema,\n      previousState\n    } = $args;\n    let accData = void 0;\n    let inputSchema = void 0;\n    for (let i = 0; i < this.$internals.procedureHandlerChain.length; i += 1) {\n      this.checkTimeoutStatus(timeoutStatus);\n      const procedureHandler = this.$internals.procedureHandlerChain[i];\n      const [data, err] = await procedureHandler(args, void 0, {\n        ctx: accData,\n        request,\n        responseMeta,\n        previousState,\n        source: new TOptsSource(() => true),\n        previousInputSchema: inputSchema,\n        onInputSchema: (schema) => {\n          inputSchema = schema;\n        }\n      });\n      if (err) {\n        throw err;\n      }\n      accData = data;\n    }\n    onInputSchema?.(inputSchema);\n    return accData;\n  }\n  /**\n   *  Run through the procedure chain and get the final static input schema\n   */\n  async getFinalStaticInputSchema(args) {\n    let inputSchema = void 0;\n    if (this.$internals.isProcedure && args.opts) {\n      await this.evaluateInputSchema({\n        ctx: void 0,\n        opts: args.opts,\n        noFunctionsAllowed: true\n      });\n      return;\n    }\n    for (const procedureHandler of this.$internals.procedureHandlerChain) {\n      await procedureHandler(void 0, void 0, {\n        source: new TOptsSource(() => true),\n        previousInputSchema: inputSchema,\n        returnInputSchema: true,\n        onInputSchema: (schema) => {\n          inputSchema = schema;\n        }\n      });\n    }\n    if (!args.opts) {\n      args.opts = {\n        source: new TOptsSource(() => true)\n      };\n    }\n    args.opts.previousInputSchema = inputSchema;\n    return await this.evaluateInputSchema({\n      ctx: void 0,\n      opts: args.opts,\n      noFunctionsAllowed: true\n    }) || zod__WEBPACK_IMPORTED_MODULE_0__.z.undefined();\n  }\n  /** set a timeout on the server action */\n  timeout(milliseconds) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      timeout: milliseconds\n    });\n  }\n  /** set a retry mechanism on the server action */\n  retry(config) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      retryConfig: config\n    });\n  }\n  /**\n   * set the input schema for the server action\n   *\n   * @example\n   * ```ts\n   * .input(z.object({\n   *   message: z.string()\n   * }))\n   * ```\n   */\n  input(schema, opts) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      // @ts-expect-error\n      inputSchema: schema,\n      inputType: opts?.type\n    });\n  }\n  /** set the output schema for the server action */\n  output(schema) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      // @ts-expect-error\n      outputSchema: schema\n    });\n  }\n  /** set a handler function for input parse errors */\n  onInputParseError(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onInputParseError: fn\n    });\n  }\n  /** set a handler function for output parse errors */\n  onOutputParseError(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onOutputParseError: fn\n    });\n  }\n  /** set a handler function for errors */\n  onError(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onErrorFns: [...this.$internals.onErrorFns || [], fn]\n    });\n  }\n  /** set a handler function for when the server action starts */\n  onStart(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onStartFns: [...this.$internals.onStartFns || [], fn]\n    });\n  }\n  /** set a handler function for when the server action succeeds */\n  onSuccess(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onSuccessFns: [...this.$internals.onSuccessFns || [], fn]\n    });\n  }\n  /** set a handler function for when the server action completes (success or error) */\n  onComplete(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onCompleteFns: [...this.$internals.onCompleteFns || [], fn]\n    });\n  }\n  /** a helper function to parse output data given the active output schema */\n  async parseOutputData(data, ctx, timeoutStatus, opts) {\n    this.checkTimeoutStatus(timeoutStatus);\n    if (!this.$internals.outputSchema)\n      return data;\n    const schema = typeof this.$internals.outputSchema === \"function\" ? await this.$internals.outputSchema({\n      ctx,\n      unparsedData: data,\n      request: opts?.request,\n      responseMeta: opts?.responseMeta,\n      previousState: opts?.previousState\n    }) : this.$internals.outputSchema;\n    if (!(schema instanceof zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodType)) {\n      throw new ZSAError(\"ERROR\", \"Output schema must be a ZodType\");\n    }\n    const safe = await schema.safeParseAsync(data);\n    if (!safe.success) {\n      if (this.$internals.onOutputParseError) {\n        await this.$internals.onOutputParseError(safe.error);\n      }\n      const flattenedErrors = safe.error.flatten();\n      const formattedErrors = safe.error.format();\n      throw new ZSAError(\"OUTPUT_PARSE_ERROR\", safe.error, {\n        outputParseErrors: {\n          fieldErrors: flattenedErrors?.fieldErrors,\n          formErrors: flattenedErrors?.formErrors,\n          formattedErrors\n        }\n      });\n    }\n    return safe.data;\n  }\n  /** helper function to handle start with timeout checkpoints */\n  async handleStart(args, timeoutStatus) {\n    this.checkTimeoutStatus(timeoutStatus);\n    if (this.$internals.isProcedure)\n      return;\n    for (const fn of this.$internals.onStartFns || []) {\n      await fn({ args });\n      this.checkTimeoutStatus(timeoutStatus);\n    }\n  }\n  /** helper function to handle success with timeout checkpoints */\n  async handleSuccess(args, data, timeoutStatus) {\n    this.checkTimeoutStatus(timeoutStatus);\n    if (this.$internals.isProcedure)\n      return;\n    for (const fn of this.$internals.onSuccessFns || []) {\n      await fn({ args, data });\n      this.checkTimeoutStatus(timeoutStatus);\n    }\n    this.checkTimeoutStatus(timeoutStatus);\n    for (const fn of this.$internals.onCompleteFns || []) {\n      await fn({\n        isSuccess: true,\n        isError: false,\n        status: \"success\",\n        args,\n        data\n      });\n      this.checkTimeoutStatus(timeoutStatus);\n    }\n  }\n  /** helper function to handle errors with timeout checkpoints */\n  async handleError(err, inputRaw, inputParsed) {\n    if (err.message === \"NEXT_REDIRECT\" || err.message === \"NEXT_NOT_FOUND\") {\n      throw err;\n    }\n    if (this.$internals.isProcedure)\n      return [null, err];\n    let customError;\n    if (this.$internals.shapeErrorFns !== void 0) {\n      let accData = void 0;\n      for (const fn of this.$internals.shapeErrorFns) {\n        accData = await fn({\n          err,\n          typedData: {\n            // @ts-expect-error\n            inputParseErrors: err instanceof ZSAError ? err.inputParseErrors : void 0,\n            // @ts-expect-error\n            outputParseErrors: err instanceof ZSAError ? err.outputParseErrors : void 0,\n            inputParsed,\n            inputRaw\n          },\n          ctx: accData\n        });\n      }\n      customError = accData;\n    } else {\n      customError = err instanceof ZSAError ? err : new ZSAError(\"ERROR\", err);\n    }\n    for (const fn of this.$internals.onErrorFns || []) {\n      await fn(customError);\n    }\n    for (const fn of this.$internals.onCompleteFns || []) {\n      await fn({\n        isSuccess: false,\n        isError: true,\n        status: \"error\",\n        error: customError\n      });\n    }\n    if (this.$internals.shapeErrorFns !== void 0) {\n      return [null, customError];\n    }\n    const stringifyIfNeeded = (data2) => typeof data2 === \"string\" ? data2 : JSON.stringify(data2);\n    let formattedErrors;\n    let flattenedErrors;\n    const data = err.data;\n    if (data instanceof zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodError && customError.code === \"INPUT_PARSE_ERROR\") {\n      formattedErrors = data.format();\n      flattenedErrors = data.flatten();\n    }\n    return [\n      null,\n      {\n        data: stringifyIfNeeded(customError.data),\n        name: customError.name,\n        message: stringifyIfNeeded(customError.message),\n        code: customError.code,\n        fieldErrors: flattenedErrors?.fieldErrors,\n        formErrors: flattenedErrors?.formErrors,\n        formattedErrors\n      }\n    ];\n  }\n  async evaluateInputSchema(args) {\n    const { ctx, opts, noFunctionsAllowed } = args;\n    let inputSchema = this.$internals.inputSchema;\n    if (noFunctionsAllowed && typeof inputSchema === \"function\") {\n      throw new Error(\"Input functions are not suppported yet\");\n    }\n    if (typeof inputSchema === \"function\") {\n      inputSchema = await inputSchema({\n        ctx,\n        previousSchema: opts?.previousInputSchema || zod__WEBPACK_IMPORTED_MODULE_0__.z.undefined(),\n        request: opts?.request,\n        responseMeta: opts?.responseMeta,\n        previousState: opts?.previousState\n      });\n    }\n    if (inputSchema && !(inputSchema instanceof zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodType)) {\n      throw new ZSAError(\"ERROR\", \"Input schema must be a ZodType\");\n    }\n    let final;\n    if (!opts?.previousInputSchema) {\n      final = inputSchema;\n    } else if (!inputSchema) {\n      final = opts.previousInputSchema;\n    } else if (instanceofZodTypeObject(opts.previousInputSchema) && instanceofZodTypeObject(inputSchema)) {\n      final = opts.previousInputSchema.merge(inputSchema);\n    } else {\n      final = inputSchema;\n    }\n    opts?.onInputSchema?.(final);\n    return final || zod__WEBPACK_IMPORTED_MODULE_0__.z.undefined();\n  }\n  /** helper function to parse input data given the active input schema */\n  async parseInputData($data, overrideData, timeoutStatus, ctx, opts) {\n    this.checkTimeoutStatus(timeoutStatus);\n    const inputSchema = await this.evaluateInputSchema({\n      ctx,\n      opts\n    });\n    let data = $data;\n    if ($data instanceof FormData && this.$internals.inputType !== \"json\") {\n      data = {\n        ...formDataToJson(data, inputSchema),\n        ...this.$internals.inputType !== \"state\" ? overrideData || {} : {}\n      };\n    }\n    const canChangeToUndefined = ($data instanceof FormData || opts?.isFromOpenApiHandler) && canDataBeUndefinedForSchema(inputSchema);\n    if (canChangeToUndefined && data && typeof data === \"object\" && Object.keys(data).length === 0) {\n      data = void 0;\n    }\n    opts?.onArgs?.(data);\n    await this.handleStart(data, timeoutStatus);\n    if (!this.$internals.inputSchema && data !== void 0 && this.$internals.isProcedure) {\n      return void 0;\n    }\n    const safe = await inputSchema.safeParseAsync(data);\n    if (!safe.success) {\n      if (this.$internals.onInputParseError) {\n        await this.$internals.onInputParseError(safe.error);\n      }\n      const flattenedErrors = safe.error.flatten();\n      const formattedErrors = safe.error.format();\n      throw new ZSAError(\"INPUT_PARSE_ERROR\", safe.error, {\n        inputParseErrors: {\n          fieldErrors: flattenedErrors?.fieldErrors,\n          formErrors: flattenedErrors?.formErrors,\n          formattedErrors\n        }\n      });\n    }\n    return safe.data;\n  }\n  /** set a handler function for when the server action starts */\n  experimental_shapeError(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      // @ts-expect-error\n      shapeErrorFns: [...this.$internals.shapeErrorFns || [], fn]\n    });\n  }\n  getTimeoutErrorPromise = (timeoutMs) => new Promise((_, reject) => {\n    setTimeout(() => {\n      reject(new ZSAError(\"TIMEOUT\", `Exceeded timeout of ${timeoutMs} ms`));\n    }, timeoutMs);\n  });\n  /** set the handler function for the server action */\n  handler(fn) {\n    const timeoutStatus = {\n      isTimeout: false\n    };\n    const wrapper = async ($args, overrideArgs, opts) => {\n      validateOpts(opts);\n      if (opts?.returnInputSchema) {\n        return await this.getFinalStaticInputSchema({\n          opts\n        });\n      } else if (opts?.returnOutputSchema) {\n        if (typeof this.$internals.outputSchema === \"function\") {\n          throw new Error(\n            \"Cannot return output schema from a function output schema\"\n          );\n        }\n        return this.$internals.outputSchema;\n      }\n      let args;\n      let parsedArgs;\n      if (this.$internals.inputType === \"state\") {\n        args = overrideArgs;\n      } else {\n        args = $args;\n      }\n      let previousState = opts?.previousState || void 0;\n      if (this.$internals.inputType === \"state\" && !this.$internals.isProcedure) {\n        previousState = $args;\n      }\n      try {\n        let ctx;\n        if (this.$internals.isProcedure && opts) {\n          ctx = opts.ctx;\n        } else {\n          ctx = await this.getProcedureChainOutput({\n            // @ts-expect-error\n            args,\n            timeoutStatus,\n            request: opts?.request,\n            responseMeta: opts?.responseMeta,\n            onInputSchema: (schema) => {\n              if (!opts) {\n                opts = {\n                  source: new TOptsSource(() => true)\n                };\n              }\n              opts.previousInputSchema = schema;\n            },\n            previousState\n          });\n        }\n        const input = await this.parseInputData(\n          args,\n          overrideArgs,\n          timeoutStatus,\n          ctx,\n          opts\n        );\n        opts?.onParsedArgs?.(input);\n        parsedArgs = input;\n        this.checkTimeoutStatus(timeoutStatus);\n        const data = await fn({\n          input,\n          ctx,\n          request: opts?.request,\n          responseMeta: opts?.responseMeta,\n          previousState\n        });\n        const parsed = await this.parseOutputData(\n          data,\n          ctx,\n          timeoutStatus,\n          opts\n        );\n        await this.handleSuccess(input, parsed, timeoutStatus);\n        return [parsed, null];\n      } catch (err) {\n        const retryDelay = this.getRetryDelay(err, opts?.attempts || 1);\n        if (retryDelay >= 0) {\n          await new Promise((r) => setTimeout(r, retryDelay));\n          return await wrapper($args, overrideArgs, {\n            ...opts || {},\n            attempts: (opts?.attempts || 1) + 1,\n            source: new TOptsSource(() => true)\n          });\n        }\n        return await this.handleError(err, args, parsedArgs);\n      }\n    };\n    const withTimeout = async (args, overrideArgs, opts) => {\n      const timeoutMs = this.$internals.timeout;\n      if (!timeoutMs)\n        return await wrapper(args, overrideArgs, opts);\n      validateOpts(opts);\n      let gotArgs = void 0;\n      let gotParsedArgs = void 0;\n      return await Promise.race([\n        wrapper(args, overrideArgs, {\n          ...opts || {},\n          onArgs: (args2) => {\n            gotArgs = args2;\n          },\n          onParsedArgs: (parsedArgs) => {\n            gotParsedArgs = parsedArgs;\n          },\n          source: new TOptsSource(() => true)\n        }),\n        this.getTimeoutErrorPromise(timeoutMs)\n      ]).then((r) => r).catch((err) => {\n        timeoutStatus.isTimeout = true;\n        return this.handleError(err, gotArgs, gotParsedArgs);\n      });\n    };\n    if (this.$internals.isProcedure) {\n      const handler = this.$internals.timeout ? withTimeout : wrapper;\n      return new CompleteProcedure({\n        inputSchema: this.$internals.inputSchema,\n        handlerChain: [...this.$internals.procedureHandlerChain, handler],\n        shapeErrorFns: this.$internals.shapeErrorFns,\n        lastHandler: handler,\n        onCompleteFns: this.$internals.onCompleteFns,\n        onErrorFns: this.$internals.onErrorFns,\n        onStartFns: this.$internals.onStartFns,\n        onSuccessFns: this.$internals.onSuccessFns,\n        timeout: this.$internals.timeout,\n        retryConfig: this.$internals.retryConfig\n      });\n    }\n    if (this.$internals.timeout) {\n      return withTimeout;\n    }\n    return wrapper;\n  }\n};\nfunction createZodSafeFunction(isProcedure, parentProcedure) {\n  return new ZodSafeFunction({\n    inputSchema: parentProcedure?.$internals.inputSchema || void 0,\n    outputSchema: void 0,\n    shapeErrorFns: parentProcedure?.$internals.shapeErrorFns || void 0,\n    isChained: parentProcedure !== void 0,\n    isProcedure: isProcedure === true,\n    procedureHandlerChain: parentProcedure?.$internals.handlerChain || [],\n    onCompleteFns: parentProcedure?.$internals.onCompleteFns,\n    onErrorFns: parentProcedure?.$internals.onErrorFns,\n    onStartFns: parentProcedure?.$internals.onStartFns,\n    onSuccessFns: parentProcedure?.$internals.onSuccessFns\n  });\n}\nfunction createServerAction() {\n  return new ZodSafeFunction({\n    inputSchema: void 0,\n    outputSchema: void 0,\n    shapeErrorFns: void 0,\n    procedureHandlerChain: []\n  });\n}\n\n// src/procedure.ts\nvar CompleteProcedure = class {\n  $internals;\n  constructor(params) {\n    this.$internals = params;\n  }\n  /** make a server action with the current procedure */\n  createServerAction() {\n    return new ZodSafeFunction({\n      inputSchema: this.$internals.inputSchema,\n      outputSchema: void 0,\n      procedureHandlerChain: this.$internals.handlerChain,\n      onErrorFns: this.$internals.onErrorFns,\n      onStartFns: this.$internals.onStartFns,\n      onSuccessFns: this.$internals.onSuccessFns,\n      onCompleteFns: this.$internals.onCompleteFns,\n      timeout: this.$internals.timeout,\n      retryConfig: this.$internals.retryConfig,\n      shapeErrorFns: this.$internals.shapeErrorFns\n    });\n  }\n};\nvar createServerActionProcedure = (parent) => {\n  return createZodSafeFunction(true, parent);\n};\nvar chainServerActionProcedures = (first, second) => {\n  return new CompleteProcedure({\n    inputSchema: second.$internals.inputSchema,\n    handlerChain: [\n      ...first.$internals.handlerChain,\n      second.$internals.lastHandler\n    ],\n    lastHandler: second.$internals.lastHandler,\n    timeout: second.$internals.timeout || first.$internals.timeout,\n    retryConfig: second.$internals.retryConfig || first.$internals.retryConfig,\n    shapeErrorFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.shapeErrorFns,\n      second.$internals.shapeErrorFns\n    ),\n    onErrorFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.onErrorFns,\n      second.$internals.onErrorFns\n    ),\n    onStartFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.onStartFns,\n      second.$internals.onStartFns\n    ),\n    onSuccessFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.onSuccessFns,\n      second.$internals.onSuccessFns\n    ),\n    onCompleteFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.onCompleteFns,\n      second.$internals.onCompleteFns\n    )\n  });\n};\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL25vZGVfbW9kdWxlcy96c2EvZGlzdC9pbmRleC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUN3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxrQ0FBQztBQUNuQztBQUNBO0FBQ0Esa0NBQWtDLGtDQUFDO0FBQ25DO0FBQ0E7QUFDQSxrQ0FBa0Msa0NBQUM7QUFDbkM7QUFDQTtBQUNBLGtDQUFrQyxrQ0FBQztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxrQ0FBQztBQUN0QztBQUNBO0FBQ0EscUNBQXFDLGtDQUFDO0FBQ3RDO0FBQ0E7QUFDQSxxQ0FBcUMsa0NBQUM7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxrQ0FBQywrREFBK0Qsa0NBQUMsb0VBQW9FLGtDQUFDO0FBQzNLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxrQ0FBQztBQUNyQztBQUNBO0FBQ0Esb0NBQW9DLGtDQUFDO0FBQ3JDO0FBQ0E7QUFDQSxvQ0FBb0Msa0NBQUM7QUFDckM7QUFDQTtBQUNBLG9DQUFvQyxrQ0FBQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDOEI7O0FBRTlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IseUJBQXlCO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLG9CQUFvQixrREFBa0Q7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSyxLQUFLLGtDQUFFO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLDRCQUE0QixrQ0FBRTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLE1BQU07QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLFlBQVk7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixrQ0FBRTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxnQ0FBZ0M7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQsa0NBQUU7QUFDdkQ7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsZ0RBQWdELGtDQUFFO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGtDQUFFO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0VBQXNFO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsNERBQTRELFdBQVc7QUFDdkUsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBeUJFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmV4dF90ZW1wbGF0ZS8uL25vZGVfbW9kdWxlcy96c2EvZGlzdC9pbmRleC5tanM/ZmFlMSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvZXJyb3JzLnRzXG52YXIgRVJST1JfQ09ERVMgPSB7XG4gIElOUFVUX1BBUlNFX0VSUk9SOiBcIklOUFVUX1BBUlNFX0VSUk9SXCIsXG4gIE9VVFBVVF9QQVJTRV9FUlJPUjogXCJPVVRQVVRfUEFSU0VfRVJST1JcIixcbiAgRVJST1I6IFwiRVJST1JcIixcbiAgTk9UX0FVVEhPUklaRUQ6IFwiTk9UX0FVVEhPUklaRURcIixcbiAgVElNRU9VVDogXCJUSU1FT1VUXCIsXG4gIElOVEVSTkFMX1NFUlZFUl9FUlJPUjogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgRk9SQklEREVOOiBcIkZPUkJJRERFTlwiLFxuICBOT1RfRk9VTkQ6IFwiTk9UX0ZPVU5EXCIsXG4gIENPTkZMSUNUOiBcIkNPTkZMSUNUXCIsXG4gIFBSRUNPTkRJVElPTl9GQUlMRUQ6IFwiUFJFQ09ORElUSU9OX0ZBSUxFRFwiLFxuICBQQVlMT0FEX1RPT19MQVJHRTogXCJQQVlMT0FEX1RPT19MQVJHRVwiLFxuICBNRVRIT0RfTk9UX1NVUFBPUlRFRDogXCJNRVRIT0RfTk9UX1NVUFBPUlRFRFwiLFxuICBVTlBST0NFU1NBQkxFX0NPTlRFTlQ6IFwiVU5QUk9DRVNTQUJMRV9DT05URU5UXCIsXG4gIFRPT19NQU5ZX1JFUVVFU1RTOiBcIlRPT19NQU5ZX1JFUVVFU1RTXCIsXG4gIENMSUVOVF9DTE9TRURfUkVRVUVTVDogXCJDTElFTlRfQ0xPU0VEX1JFUVVFU1RcIixcbiAgSU5TVUZGSUNJRU5UX0NSRURJVFM6IFwiSU5TVUZGSUNJRU5UX0NSRURJVFNcIixcbiAgUEFZTUVOVF9SRVFVSVJFRDogXCJQQVlNRU5UX1JFUVVJUkVEXCJcbn07XG52YXIgWlNBRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgLyoqIHRoZSBFcnJvciBvYmplY3QgdGhyb3duICovXG4gIGRhdGE7XG4gIC8qKiB0aGUgZXJyb3IgY29kZSAqL1xuICBjb2RlO1xuICBpbnB1dFBhcnNlRXJyb3JzO1xuICBvdXRwdXRQYXJzZUVycm9ycztcbiAgY29uc3RydWN0b3IoY29kZSA9IEVSUk9SX0NPREVTLkVSUk9SLCBkYXRhLCBtb3JlKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgIHRoaXMuY29kZSA9IGNvZGU7XG4gICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgdGhpcy5tZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xuICAgICAgdGhpcy5zdGFjayA9IGRhdGEuc3RhY2s7XG4gICAgICB0aGlzLm5hbWUgPSBkYXRhLm5hbWU7XG4gICAgICB0aGlzLmNhdXNlID0gZGF0YS5jYXVzZTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLm1lc3NhZ2UgJiYgdHlwZW9mIHRoaXMuZGF0YSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgdGhpcy5tZXNzYWdlID0gdGhpcy5kYXRhO1xuICAgIH1cbiAgICB0aGlzLmlucHV0UGFyc2VFcnJvcnMgPSBtb3JlPy5pbnB1dFBhcnNlRXJyb3JzO1xuICAgIHRoaXMub3V0cHV0UGFyc2VFcnJvcnMgPSBtb3JlPy5vdXRwdXRQYXJzZUVycm9ycztcbiAgfVxufTtcblxuLy8gc3JjL3V0aWxzLnRzXG5pbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xudmFyIGluc3RhbmNlb2Zab2RUeXBlS2luZCA9ICh0eXBlLCB6b2RUeXBlS2luZCkgPT4ge1xuICByZXR1cm4gdHlwZT8uX2RlZj8udHlwZU5hbWUgPT09IHpvZFR5cGVLaW5kO1xufTtcbnZhciB1bndyYXBab2RUeXBlID0gKHR5cGUsIHVud3JhcFByZXByb2Nlc3MpID0+IHtcbiAgaWYgKGluc3RhbmNlb2Zab2RUeXBlS2luZCh0eXBlLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2RPcHRpb25hbCkpIHtcbiAgICByZXR1cm4gdW53cmFwWm9kVHlwZSh0eXBlLnVud3JhcCgpLCB1bndyYXBQcmVwcm9jZXNzKTtcbiAgfVxuICBpZiAoaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHR5cGUsIHouWm9kRmlyc3RQYXJ0eVR5cGVLaW5kLlpvZERlZmF1bHQpKSB7XG4gICAgcmV0dXJuIHVud3JhcFpvZFR5cGUodHlwZS5yZW1vdmVEZWZhdWx0KCksIHVud3JhcFByZXByb2Nlc3MpO1xuICB9XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUtpbmQodHlwZSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kTGF6eSkpIHtcbiAgICByZXR1cm4gdW53cmFwWm9kVHlwZSh0eXBlLl9kZWYuZ2V0dGVyKCksIHVud3JhcFByZXByb2Nlc3MpO1xuICB9XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUtpbmQodHlwZSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kRWZmZWN0cykpIHtcbiAgICBpZiAodHlwZS5fZGVmLmVmZmVjdC50eXBlID09PSBcInJlZmluZW1lbnRcIikge1xuICAgICAgcmV0dXJuIHVud3JhcFpvZFR5cGUodHlwZS5fZGVmLnNjaGVtYSwgdW53cmFwUHJlcHJvY2Vzcyk7XG4gICAgfVxuICAgIGlmICh0eXBlLl9kZWYuZWZmZWN0LnR5cGUgPT09IFwidHJhbnNmb3JtXCIpIHtcbiAgICAgIHJldHVybiB1bndyYXBab2RUeXBlKHR5cGUuX2RlZi5zY2hlbWEsIHVud3JhcFByZXByb2Nlc3MpO1xuICAgIH1cbiAgICBpZiAodW53cmFwUHJlcHJvY2VzcyAmJiB0eXBlLl9kZWYuZWZmZWN0LnR5cGUgPT09IFwicHJlcHJvY2Vzc1wiKSB7XG4gICAgICByZXR1cm4gdW53cmFwWm9kVHlwZSh0eXBlLl9kZWYuc2NoZW1hLCB1bndyYXBQcmVwcm9jZXNzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHR5cGU7XG59O1xudmFyIGluc3RhbmNlb2Zab2RUeXBlT2JqZWN0ID0gKHR5cGUpID0+IHtcbiAgcmV0dXJuIGluc3RhbmNlb2Zab2RUeXBlS2luZCh0eXBlLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2RPYmplY3QpO1xufTtcbnZhciBpbnN0YW5jZW9mWm9kVHlwZUFycmF5ID0gKHR5cGUpID0+IHtcbiAgcmV0dXJuIGluc3RhbmNlb2Zab2RUeXBlS2luZCh0eXBlLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2RBcnJheSk7XG59O1xudmFyIGluc3RhbmNlb2Zab2RUeXBlQm9vbGVhbiA9ICh0eXBlKSA9PiB7XG4gIHJldHVybiBpbnN0YW5jZW9mWm9kVHlwZUtpbmQodHlwZSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kQm9vbGVhbik7XG59O1xudmFyIHVud3JhcEtleUluWm9kU2NoZW1hID0gKGtleSwgc2NoZW1hKSA9PiB7XG4gIGNvbnN0IHVud3JhcHBlZCA9IHVud3JhcFpvZFR5cGUoc2NoZW1hLCB0cnVlKTtcbiAgY29uc3QgaXNPYmplY3QgPSBpbnN0YW5jZW9mWm9kVHlwZU9iamVjdCh1bndyYXBwZWQpO1xuICBpZiAoIWlzT2JqZWN0KVxuICAgIHJldHVybiBudWxsO1xuICBjb25zdCBzaGFwZSA9IHVud3JhcHBlZC5zaGFwZTtcbiAgaWYgKCEoa2V5IGluIHNoYXBlKSlcbiAgICByZXR1cm4gbnVsbDtcbiAgY29uc3QgdmFsdWUgPSBzaGFwZVtrZXldO1xuICBpZiAoIXZhbHVlKVxuICAgIHJldHVybiBudWxsO1xuICByZXR1cm4gdW53cmFwWm9kVHlwZSh2YWx1ZSwgdHJ1ZSk7XG59O1xudmFyIGlzS2V5QW5BcnJheUluWm9kU2NoZW1hID0gKGtleSwgc2NoZW1hKSA9PiB7XG4gIGNvbnN0IHVud3JhcHBlZFZhbHVlID0gdW53cmFwS2V5SW5ab2RTY2hlbWEoa2V5LCBzY2hlbWEpO1xuICBpZiAodW53cmFwcGVkVmFsdWUgPT09IG51bGwpXG4gICAgcmV0dXJuIGZhbHNlO1xuICBjb25zdCBpc0FycmF5ID0gaW5zdGFuY2VvZlpvZFR5cGVBcnJheSh1bndyYXBwZWRWYWx1ZSk7XG4gIHJldHVybiBpc0FycmF5O1xufTtcbnZhciBpc0tleUFCb29sZWFuSW5ab2RTY2hlbWEgPSAoa2V5LCBzY2hlbWEpID0+IHtcbiAgY29uc3QgdW53cmFwcGVkVmFsdWUgPSB1bndyYXBLZXlJblpvZFNjaGVtYShrZXksIHNjaGVtYSk7XG4gIGlmICh1bndyYXBwZWRWYWx1ZSA9PT0gbnVsbClcbiAgICByZXR1cm4gZmFsc2U7XG4gIGNvbnN0IGlzQXJyYXkgPSBpbnN0YW5jZW9mWm9kVHlwZUJvb2xlYW4odW53cmFwcGVkVmFsdWUpO1xuICByZXR1cm4gaXNBcnJheTtcbn07XG52YXIgZm9ybURhdGFUb0pzb24gPSAoZm9ybURhdGEsIGlucHV0U2NoZW1hKSA9PiB7XG4gIGNvbnN0IGpzb24gPSB7fTtcbiAgZm9ybURhdGEuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xuICAgIGNvbnN0IGlzQXJyYXlTY2hlbWEgPSBpc0tleUFuQXJyYXlJblpvZFNjaGVtYShrZXksIGlucHV0U2NoZW1hKTtcbiAgICBjb25zdCBpc0Jvb2xlYW5TY2hlbWEgPSBpc0tleUFCb29sZWFuSW5ab2RTY2hlbWEoa2V5LCBpbnB1dFNjaGVtYSk7XG4gICAgaWYgKCFSZWZsZWN0Lmhhcyhqc29uLCBrZXkpKSB7XG4gICAgICBqc29uW2tleV0gPSBpc0FycmF5U2NoZW1hID8gW3ZhbHVlXSA6IHZhbHVlO1xuICAgICAgaWYgKGlzQm9vbGVhblNjaGVtYSkge1xuICAgICAgICBpZiAoanNvbltrZXldID09PSBcInRydWVcIilcbiAgICAgICAgICBqc29uW2tleV0gPSB0cnVlO1xuICAgICAgICBpZiAoanNvbltrZXldID09PSBcImZhbHNlXCIpXG4gICAgICAgICAganNvbltrZXldID0gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghQXJyYXkuaXNBcnJheShqc29uW2tleV0pKSB7XG4gICAgICBqc29uW2tleV0gPSBbanNvbltrZXldXTtcbiAgICB9XG4gICAganNvbltrZXldLnB1c2godmFsdWUpO1xuICB9KTtcbiAgcmV0dXJuIGpzb247XG59O1xudmFyIGFkZFRvTnVsbGlzaEFycmF5ID0gKGFycmF5LCB2YWx1ZSkgPT4ge1xuICBpZiAoIWFycmF5ICYmICF2YWx1ZSlcbiAgICByZXR1cm4gdm9pZCAwO1xuICBpZiAoIXZhbHVlKVxuICAgIHJldHVybiBhcnJheTtcbiAgY29uc3QgdGVtcCA9IFsuLi5hcnJheSB8fCBbXV07XG4gIHRlbXAucHVzaCh2YWx1ZSk7XG4gIHJldHVybiB0ZW1wO1xufTtcbnZhciBtZXJnZUFycmF5c0FuZFJlbW92ZUR1cGxpY2F0ZXMgPSAoYXJyYXkxLCBhcnJheTIpID0+IHtcbiAgaWYgKCFhcnJheTEgJiYgIWFycmF5MilcbiAgICByZXR1cm4gdm9pZCAwO1xuICBpZiAoIWFycmF5MilcbiAgICByZXR1cm4gYXJyYXkxO1xuICBpZiAoIWFycmF5MSlcbiAgICByZXR1cm4gYXJyYXkyO1xuICBjb25zdCB0ZW1wID0gWy4uLmFycmF5MSB8fCBbXSwgLi4uYXJyYXkyIHx8IFtdXTtcbiAgcmV0dXJuIFsuLi5uZXcgU2V0KHRlbXApXTtcbn07XG52YXIgaW5zdGFuY2VvZlpvZFR5cGVMaWtlVm9pZCA9ICh0eXBlKSA9PiB7XG4gIHJldHVybiBpbnN0YW5jZW9mWm9kVHlwZUtpbmQodHlwZSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kVm9pZCkgfHwgaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHR5cGUsIHouWm9kRmlyc3RQYXJ0eVR5cGVLaW5kLlpvZFVuZGVmaW5lZCkgfHwgaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHR5cGUsIHouWm9kRmlyc3RQYXJ0eVR5cGVLaW5kLlpvZE5ldmVyKTtcbn07XG52YXIgY2FuRGF0YUJlVW5kZWZpbmVkRm9yU2NoZW1hID0gKHNjaGVtYSkgPT4ge1xuICBpZiAoIXNjaGVtYSlcbiAgICByZXR1cm4gdHJ1ZTtcbiAgaWYgKGluc3RhbmNlb2Zab2RUeXBlTGlrZVZvaWQoc2NoZW1hKSlcbiAgICByZXR1cm4gdHJ1ZTtcbiAgaWYgKGluc3RhbmNlb2Zab2RUeXBlS2luZChzY2hlbWEsIHouWm9kRmlyc3RQYXJ0eVR5cGVLaW5kLlpvZE9wdGlvbmFsKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUtpbmQoc2NoZW1hLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2REZWZhdWx0KSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUtpbmQoc2NoZW1hLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2RMYXp5KSkge1xuICAgIHJldHVybiBjYW5EYXRhQmVVbmRlZmluZWRGb3JTY2hlbWEoc2NoZW1hLl9kZWYuZ2V0dGVyKCkpO1xuICB9XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUtpbmQoc2NoZW1hLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2RFZmZlY3RzKSkge1xuICAgIGlmIChzY2hlbWEuX2RlZi5lZmZlY3QudHlwZSA9PT0gXCJyZWZpbmVtZW50XCIpIHtcbiAgICAgIHJldHVybiBjYW5EYXRhQmVVbmRlZmluZWRGb3JTY2hlbWEoc2NoZW1hLl9kZWYuc2NoZW1hKTtcbiAgICB9XG4gICAgaWYgKHNjaGVtYS5fZGVmLmVmZmVjdC50eXBlID09PSBcInRyYW5zZm9ybVwiKSB7XG4gICAgICByZXR1cm4gY2FuRGF0YUJlVW5kZWZpbmVkRm9yU2NoZW1hKHNjaGVtYS5fZGVmLnNjaGVtYSk7XG4gICAgfVxuICAgIGlmIChzY2hlbWEuX2RlZi5lZmZlY3QudHlwZSA9PT0gXCJwcmVwcm9jZXNzXCIpIHtcbiAgICAgIHJldHVybiBjYW5EYXRhQmVVbmRlZmluZWRGb3JTY2hlbWEoc2NoZW1hLl9kZWYuc2NoZW1hKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLy8gc3JjL3pvZC1zYWZlLWZ1bmN0aW9uLnRzXG5pbXBvcnQgeyB6IGFzIHoyIH0gZnJvbSBcInpvZFwiO1xuXG4vLyBzcmMvdHlwZXMudHNcbnZhciBUT3B0c1NvdXJjZSA9IGNsYXNzIHtcbiAgdmFsaWRhdGU7XG4gIGNvbnN0cnVjdG9yKHZhbGlkYXRlKSB7XG4gICAgdGhpcy52YWxpZGF0ZSA9IHZhbGlkYXRlO1xuICB9XG59O1xudmFyIERlZmF1bHRPbWl0dGVkID0ge1xuICAkaW50ZXJuYWxzOiAxLFxuICBoYW5kbGVFcnJvcjogMSxcbiAgb25JbnB1dFBhcnNlRXJyb3I6IDEsXG4gIGdldFRpbWVvdXRFcnJvclByb21pc2U6IDEsXG4gIGdldFByb2NlZHVyZUNoYWluT3V0cHV0OiAxLFxuICBoYW5kbGVTdWNjZXNzOiAxLFxuICBoYW5kbGVTdGFydDogMSxcbiAgcGFyc2VJbnB1dERhdGE6IDEsXG4gIHBhcnNlT3V0cHV0RGF0YTogMSxcbiAgb25PdXRwdXRQYXJzZUVycm9yOiAxLFxuICBjaGVja1RpbWVvdXRTdGF0dXM6IDEsXG4gIGdldFJldHJ5RGVsYXk6IDEsXG4gIGV2YWx1YXRlSW5wdXRTY2hlbWE6IDEsXG4gIGdldEZpbmFsU3RhdGljSW5wdXRTY2hlbWE6IDFcbn07XG52YXIgWlNBUmVzcG9uc2VNZXRhID0gY2xhc3Mge1xuICAvKipcbiAgICogdGhlIGhlYWRlcnMgb2YgdGhlIHJlc3BvbnNlXG4gICAqL1xuICBoZWFkZXJzO1xuICAvKipcbiAgICogdGhlIHN0YXR1cyBjb2RlIG9mIHRoZSByZXNwb25zZVxuICAgKlxuICAgKiBAZGVmYXVsdCAyMDBcbiAgICovXG4gIHN0YXR1c0NvZGU7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuc3RhdHVzQ29kZSA9IDIwMDtcbiAgICB0aGlzLmhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xuICB9XG59O1xudmFyIFNoYXBlRXJyb3JOb3RTZXQgPSBcIlNoYXBlRXJyb3JOb3RTZXRcIjtcblxuLy8gc3JjL3pvZC1zYWZlLWZ1bmN0aW9uLnRzXG52YXIgdmFsaWRhdGVPcHRzID0gKG9wdHMpID0+IHtcbiAgaWYgKG9wdHMgJiYgKCEob3B0cy5zb3VyY2UgaW5zdGFuY2VvZiBUT3B0c1NvdXJjZSkgfHwgIW9wdHMuc291cmNlLnZhbGlkYXRlKCkpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBvcHRzLCBtdXN0IG9yaWdpbmF0ZSBmcm9tIHRoZSBzZXJ2ZXJcIik7XG4gIH1cbn07XG52YXIgWm9kU2FmZUZ1bmN0aW9uID0gY2xhc3MgX1pvZFNhZmVGdW5jdGlvbiB7XG4gIC8qKiBUaGUgaW50ZXJuYWxzIG9mIHRoZSBab2QgU2FmZSBGdW5jdGlvbiAqL1xuICAkaW50ZXJuYWxzO1xuICBjb25zdHJ1Y3RvcihpbnRlcm5hbHMpIHtcbiAgICB0aGlzLiRpbnRlcm5hbHMgPSBpbnRlcm5hbHM7XG4gIH1cbiAgLyoqIENoZWNrIGlmIHRoZSB0aW1lb3V0IGhhcyB0cmlnZ2VyZWQsIGlmIHNvLCB0aHJvdyBhIFpTQUVycm9yICovXG4gIGNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKSB7XG4gICAgaWYgKHRpbWVvdXRTdGF0dXMuaXNUaW1lb3V0KSB7XG4gICAgICB0aHJvdyBuZXcgWlNBRXJyb3IoXG4gICAgICAgIFwiVElNRU9VVFwiLFxuICAgICAgICBgRXhjZWVkZWQgdGltZW91dCBvZiAke3RoaXMuJGludGVybmFscy50aW1lb3V0fSBtc2BcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKlxuICAgKiBHZXQgdGhlIHJldHJ5IGRlbGF5IGZvciB0aGUgY3VycmVudCByZXRyeSBhdHRlbXB0XG4gICAqXG4gICAqIElmIHRoZXJlIHNob3VsZCBiZSBubyByZXRyeSwgcmV0dXJucyAtMVxuICAgKi9cbiAgZ2V0UmV0cnlEZWxheSgkZXJyLCBjdXJyZW50QXR0ZW1wdCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBlcnIgPSAkZXJyIGluc3RhbmNlb2YgWlNBRXJyb3IgPyAkZXJyIDogbmV3IFpTQUVycm9yKFwiRVJST1JcIiwgJGVycik7XG4gICAgICBpZiAoZXJyLmNvZGUgPT09IFwiVElNRU9VVFwiKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuJGludGVybmFscy5yZXRyeUNvbmZpZztcbiAgICAgIGlmICghY29uZmlnKVxuICAgICAgICByZXR1cm4gLTE7XG4gICAgICBpZiAodGhpcy4kaW50ZXJuYWxzLmlzUHJvY2VkdXJlKVxuICAgICAgICByZXR1cm4gLTE7XG4gICAgICBjb25zdCBzaG91bGRSZXRyeSA9IGN1cnJlbnRBdHRlbXB0IDwgY29uZmlnLm1heEF0dGVtcHRzO1xuICAgICAgbGV0IHJldHJ5RGVsYXkgPSAwO1xuICAgICAgaWYgKHR5cGVvZiBjb25maWcuZGVsYXkgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICByZXRyeURlbGF5ID0gY29uZmlnLmRlbGF5KGN1cnJlbnRBdHRlbXB0LCBlcnIpO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY29uZmlnLmRlbGF5ID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgIHJldHJ5RGVsYXkgPSBjb25maWcuZGVsYXk7XG4gICAgICB9XG4gICAgICBpZiAoc2hvdWxkUmV0cnkpXG4gICAgICAgIHJldHVybiByZXRyeURlbGF5O1xuICAgICAgcmV0dXJuIC0xO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogIFJ1biB0aHJvdWdoIHRoZSBwcm9jZWR1cmUgY2hhaW4gYW5kIGdldCB0aGUgZmluYWwgY29udGV4dFxuICAgKi9cbiAgYXN5bmMgZ2V0UHJvY2VkdXJlQ2hhaW5PdXRwdXQoJGFyZ3MpIHtcbiAgICBjb25zdCB7XG4gICAgICBhcmdzLFxuICAgICAgdGltZW91dFN0YXR1cyxcbiAgICAgIHJlcXVlc3QsXG4gICAgICByZXNwb25zZU1ldGEsXG4gICAgICBvbklucHV0U2NoZW1hLFxuICAgICAgcHJldmlvdXNTdGF0ZVxuICAgIH0gPSAkYXJncztcbiAgICBsZXQgYWNjRGF0YSA9IHZvaWQgMDtcbiAgICBsZXQgaW5wdXRTY2hlbWEgPSB2b2lkIDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLiRpbnRlcm5hbHMucHJvY2VkdXJlSGFuZGxlckNoYWluLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICB0aGlzLmNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKTtcbiAgICAgIGNvbnN0IHByb2NlZHVyZUhhbmRsZXIgPSB0aGlzLiRpbnRlcm5hbHMucHJvY2VkdXJlSGFuZGxlckNoYWluW2ldO1xuICAgICAgY29uc3QgW2RhdGEsIGVycl0gPSBhd2FpdCBwcm9jZWR1cmVIYW5kbGVyKGFyZ3MsIHZvaWQgMCwge1xuICAgICAgICBjdHg6IGFjY0RhdGEsXG4gICAgICAgIHJlcXVlc3QsXG4gICAgICAgIHJlc3BvbnNlTWV0YSxcbiAgICAgICAgcHJldmlvdXNTdGF0ZSxcbiAgICAgICAgc291cmNlOiBuZXcgVE9wdHNTb3VyY2UoKCkgPT4gdHJ1ZSksXG4gICAgICAgIHByZXZpb3VzSW5wdXRTY2hlbWE6IGlucHV0U2NoZW1hLFxuICAgICAgICBvbklucHV0U2NoZW1hOiAoc2NoZW1hKSA9PiB7XG4gICAgICAgICAgaW5wdXRTY2hlbWEgPSBzY2hlbWE7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKGVycikge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICBhY2NEYXRhID0gZGF0YTtcbiAgICB9XG4gICAgb25JbnB1dFNjaGVtYT8uKGlucHV0U2NoZW1hKTtcbiAgICByZXR1cm4gYWNjRGF0YTtcbiAgfVxuICAvKipcbiAgICogIFJ1biB0aHJvdWdoIHRoZSBwcm9jZWR1cmUgY2hhaW4gYW5kIGdldCB0aGUgZmluYWwgc3RhdGljIGlucHV0IHNjaGVtYVxuICAgKi9cbiAgYXN5bmMgZ2V0RmluYWxTdGF0aWNJbnB1dFNjaGVtYShhcmdzKSB7XG4gICAgbGV0IGlucHV0U2NoZW1hID0gdm9pZCAwO1xuICAgIGlmICh0aGlzLiRpbnRlcm5hbHMuaXNQcm9jZWR1cmUgJiYgYXJncy5vcHRzKSB7XG4gICAgICBhd2FpdCB0aGlzLmV2YWx1YXRlSW5wdXRTY2hlbWEoe1xuICAgICAgICBjdHg6IHZvaWQgMCxcbiAgICAgICAgb3B0czogYXJncy5vcHRzLFxuICAgICAgICBub0Z1bmN0aW9uc0FsbG93ZWQ6IHRydWVcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHByb2NlZHVyZUhhbmRsZXIgb2YgdGhpcy4kaW50ZXJuYWxzLnByb2NlZHVyZUhhbmRsZXJDaGFpbikge1xuICAgICAgYXdhaXQgcHJvY2VkdXJlSGFuZGxlcih2b2lkIDAsIHZvaWQgMCwge1xuICAgICAgICBzb3VyY2U6IG5ldyBUT3B0c1NvdXJjZSgoKSA9PiB0cnVlKSxcbiAgICAgICAgcHJldmlvdXNJbnB1dFNjaGVtYTogaW5wdXRTY2hlbWEsXG4gICAgICAgIHJldHVybklucHV0U2NoZW1hOiB0cnVlLFxuICAgICAgICBvbklucHV0U2NoZW1hOiAoc2NoZW1hKSA9PiB7XG4gICAgICAgICAgaW5wdXRTY2hlbWEgPSBzY2hlbWE7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoIWFyZ3Mub3B0cykge1xuICAgICAgYXJncy5vcHRzID0ge1xuICAgICAgICBzb3VyY2U6IG5ldyBUT3B0c1NvdXJjZSgoKSA9PiB0cnVlKVxuICAgICAgfTtcbiAgICB9XG4gICAgYXJncy5vcHRzLnByZXZpb3VzSW5wdXRTY2hlbWEgPSBpbnB1dFNjaGVtYTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ldmFsdWF0ZUlucHV0U2NoZW1hKHtcbiAgICAgIGN0eDogdm9pZCAwLFxuICAgICAgb3B0czogYXJncy5vcHRzLFxuICAgICAgbm9GdW5jdGlvbnNBbGxvd2VkOiB0cnVlXG4gICAgfSkgfHwgejIudW5kZWZpbmVkKCk7XG4gIH1cbiAgLyoqIHNldCBhIHRpbWVvdXQgb24gdGhlIHNlcnZlciBhY3Rpb24gKi9cbiAgdGltZW91dChtaWxsaXNlY29uZHMpIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgdGltZW91dDogbWlsbGlzZWNvbmRzXG4gICAgfSk7XG4gIH1cbiAgLyoqIHNldCBhIHJldHJ5IG1lY2hhbmlzbSBvbiB0aGUgc2VydmVyIGFjdGlvbiAqL1xuICByZXRyeShjb25maWcpIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgcmV0cnlDb25maWc6IGNvbmZpZ1xuICAgIH0pO1xuICB9XG4gIC8qKlxuICAgKiBzZXQgdGhlIGlucHV0IHNjaGVtYSBmb3IgdGhlIHNlcnZlciBhY3Rpb25cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgdHNcbiAgICogLmlucHV0KHoub2JqZWN0KHtcbiAgICogICBtZXNzYWdlOiB6LnN0cmluZygpXG4gICAqIH0pKVxuICAgKiBgYGBcbiAgICovXG4gIGlucHV0KHNjaGVtYSwgb3B0cykge1xuICAgIHJldHVybiBuZXcgX1pvZFNhZmVGdW5jdGlvbih7XG4gICAgICAuLi50aGlzLiRpbnRlcm5hbHMsXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgICBpbnB1dFNjaGVtYTogc2NoZW1hLFxuICAgICAgaW5wdXRUeXBlOiBvcHRzPy50eXBlXG4gICAgfSk7XG4gIH1cbiAgLyoqIHNldCB0aGUgb3V0cHV0IHNjaGVtYSBmb3IgdGhlIHNlcnZlciBhY3Rpb24gKi9cbiAgb3V0cHV0KHNjaGVtYSkge1xuICAgIHJldHVybiBuZXcgX1pvZFNhZmVGdW5jdGlvbih7XG4gICAgICAuLi50aGlzLiRpbnRlcm5hbHMsXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgICBvdXRwdXRTY2hlbWE6IHNjaGVtYVxuICAgIH0pO1xuICB9XG4gIC8qKiBzZXQgYSBoYW5kbGVyIGZ1bmN0aW9uIGZvciBpbnB1dCBwYXJzZSBlcnJvcnMgKi9cbiAgb25JbnB1dFBhcnNlRXJyb3IoZm4pIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgb25JbnB1dFBhcnNlRXJyb3I6IGZuXG4gICAgfSk7XG4gIH1cbiAgLyoqIHNldCBhIGhhbmRsZXIgZnVuY3Rpb24gZm9yIG91dHB1dCBwYXJzZSBlcnJvcnMgKi9cbiAgb25PdXRwdXRQYXJzZUVycm9yKGZuKSB7XG4gICAgcmV0dXJuIG5ldyBfWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICAgIC4uLnRoaXMuJGludGVybmFscyxcbiAgICAgIG9uT3V0cHV0UGFyc2VFcnJvcjogZm5cbiAgICB9KTtcbiAgfVxuICAvKiogc2V0IGEgaGFuZGxlciBmdW5jdGlvbiBmb3IgZXJyb3JzICovXG4gIG9uRXJyb3IoZm4pIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgb25FcnJvckZuczogWy4uLnRoaXMuJGludGVybmFscy5vbkVycm9yRm5zIHx8IFtdLCBmbl1cbiAgICB9KTtcbiAgfVxuICAvKiogc2V0IGEgaGFuZGxlciBmdW5jdGlvbiBmb3Igd2hlbiB0aGUgc2VydmVyIGFjdGlvbiBzdGFydHMgKi9cbiAgb25TdGFydChmbikge1xuICAgIHJldHVybiBuZXcgX1pvZFNhZmVGdW5jdGlvbih7XG4gICAgICAuLi50aGlzLiRpbnRlcm5hbHMsXG4gICAgICBvblN0YXJ0Rm5zOiBbLi4udGhpcy4kaW50ZXJuYWxzLm9uU3RhcnRGbnMgfHwgW10sIGZuXVxuICAgIH0pO1xuICB9XG4gIC8qKiBzZXQgYSBoYW5kbGVyIGZ1bmN0aW9uIGZvciB3aGVuIHRoZSBzZXJ2ZXIgYWN0aW9uIHN1Y2NlZWRzICovXG4gIG9uU3VjY2Vzcyhmbikge1xuICAgIHJldHVybiBuZXcgX1pvZFNhZmVGdW5jdGlvbih7XG4gICAgICAuLi50aGlzLiRpbnRlcm5hbHMsXG4gICAgICBvblN1Y2Nlc3NGbnM6IFsuLi50aGlzLiRpbnRlcm5hbHMub25TdWNjZXNzRm5zIHx8IFtdLCBmbl1cbiAgICB9KTtcbiAgfVxuICAvKiogc2V0IGEgaGFuZGxlciBmdW5jdGlvbiBmb3Igd2hlbiB0aGUgc2VydmVyIGFjdGlvbiBjb21wbGV0ZXMgKHN1Y2Nlc3Mgb3IgZXJyb3IpICovXG4gIG9uQ29tcGxldGUoZm4pIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgb25Db21wbGV0ZUZuczogWy4uLnRoaXMuJGludGVybmFscy5vbkNvbXBsZXRlRm5zIHx8IFtdLCBmbl1cbiAgICB9KTtcbiAgfVxuICAvKiogYSBoZWxwZXIgZnVuY3Rpb24gdG8gcGFyc2Ugb3V0cHV0IGRhdGEgZ2l2ZW4gdGhlIGFjdGl2ZSBvdXRwdXQgc2NoZW1hICovXG4gIGFzeW5jIHBhcnNlT3V0cHV0RGF0YShkYXRhLCBjdHgsIHRpbWVvdXRTdGF0dXMsIG9wdHMpIHtcbiAgICB0aGlzLmNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKTtcbiAgICBpZiAoIXRoaXMuJGludGVybmFscy5vdXRwdXRTY2hlbWEpXG4gICAgICByZXR1cm4gZGF0YTtcbiAgICBjb25zdCBzY2hlbWEgPSB0eXBlb2YgdGhpcy4kaW50ZXJuYWxzLm91dHB1dFNjaGVtYSA9PT0gXCJmdW5jdGlvblwiID8gYXdhaXQgdGhpcy4kaW50ZXJuYWxzLm91dHB1dFNjaGVtYSh7XG4gICAgICBjdHgsXG4gICAgICB1bnBhcnNlZERhdGE6IGRhdGEsXG4gICAgICByZXF1ZXN0OiBvcHRzPy5yZXF1ZXN0LFxuICAgICAgcmVzcG9uc2VNZXRhOiBvcHRzPy5yZXNwb25zZU1ldGEsXG4gICAgICBwcmV2aW91c1N0YXRlOiBvcHRzPy5wcmV2aW91c1N0YXRlXG4gICAgfSkgOiB0aGlzLiRpbnRlcm5hbHMub3V0cHV0U2NoZW1hO1xuICAgIGlmICghKHNjaGVtYSBpbnN0YW5jZW9mIHoyLlpvZFR5cGUpKSB7XG4gICAgICB0aHJvdyBuZXcgWlNBRXJyb3IoXCJFUlJPUlwiLCBcIk91dHB1dCBzY2hlbWEgbXVzdCBiZSBhIFpvZFR5cGVcIik7XG4gICAgfVxuICAgIGNvbnN0IHNhZmUgPSBhd2FpdCBzY2hlbWEuc2FmZVBhcnNlQXN5bmMoZGF0YSk7XG4gICAgaWYgKCFzYWZlLnN1Y2Nlc3MpIHtcbiAgICAgIGlmICh0aGlzLiRpbnRlcm5hbHMub25PdXRwdXRQYXJzZUVycm9yKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuJGludGVybmFscy5vbk91dHB1dFBhcnNlRXJyb3Ioc2FmZS5lcnJvcik7XG4gICAgICB9XG4gICAgICBjb25zdCBmbGF0dGVuZWRFcnJvcnMgPSBzYWZlLmVycm9yLmZsYXR0ZW4oKTtcbiAgICAgIGNvbnN0IGZvcm1hdHRlZEVycm9ycyA9IHNhZmUuZXJyb3IuZm9ybWF0KCk7XG4gICAgICB0aHJvdyBuZXcgWlNBRXJyb3IoXCJPVVRQVVRfUEFSU0VfRVJST1JcIiwgc2FmZS5lcnJvciwge1xuICAgICAgICBvdXRwdXRQYXJzZUVycm9yczoge1xuICAgICAgICAgIGZpZWxkRXJyb3JzOiBmbGF0dGVuZWRFcnJvcnM/LmZpZWxkRXJyb3JzLFxuICAgICAgICAgIGZvcm1FcnJvcnM6IGZsYXR0ZW5lZEVycm9ycz8uZm9ybUVycm9ycyxcbiAgICAgICAgICBmb3JtYXR0ZWRFcnJvcnNcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBzYWZlLmRhdGE7XG4gIH1cbiAgLyoqIGhlbHBlciBmdW5jdGlvbiB0byBoYW5kbGUgc3RhcnQgd2l0aCB0aW1lb3V0IGNoZWNrcG9pbnRzICovXG4gIGFzeW5jIGhhbmRsZVN0YXJ0KGFyZ3MsIHRpbWVvdXRTdGF0dXMpIHtcbiAgICB0aGlzLmNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKTtcbiAgICBpZiAodGhpcy4kaW50ZXJuYWxzLmlzUHJvY2VkdXJlKVxuICAgICAgcmV0dXJuO1xuICAgIGZvciAoY29uc3QgZm4gb2YgdGhpcy4kaW50ZXJuYWxzLm9uU3RhcnRGbnMgfHwgW10pIHtcbiAgICAgIGF3YWl0IGZuKHsgYXJncyB9KTtcbiAgICAgIHRoaXMuY2hlY2tUaW1lb3V0U3RhdHVzKHRpbWVvdXRTdGF0dXMpO1xuICAgIH1cbiAgfVxuICAvKiogaGVscGVyIGZ1bmN0aW9uIHRvIGhhbmRsZSBzdWNjZXNzIHdpdGggdGltZW91dCBjaGVja3BvaW50cyAqL1xuICBhc3luYyBoYW5kbGVTdWNjZXNzKGFyZ3MsIGRhdGEsIHRpbWVvdXRTdGF0dXMpIHtcbiAgICB0aGlzLmNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKTtcbiAgICBpZiAodGhpcy4kaW50ZXJuYWxzLmlzUHJvY2VkdXJlKVxuICAgICAgcmV0dXJuO1xuICAgIGZvciAoY29uc3QgZm4gb2YgdGhpcy4kaW50ZXJuYWxzLm9uU3VjY2Vzc0ZucyB8fCBbXSkge1xuICAgICAgYXdhaXQgZm4oeyBhcmdzLCBkYXRhIH0pO1xuICAgICAgdGhpcy5jaGVja1RpbWVvdXRTdGF0dXModGltZW91dFN0YXR1cyk7XG4gICAgfVxuICAgIHRoaXMuY2hlY2tUaW1lb3V0U3RhdHVzKHRpbWVvdXRTdGF0dXMpO1xuICAgIGZvciAoY29uc3QgZm4gb2YgdGhpcy4kaW50ZXJuYWxzLm9uQ29tcGxldGVGbnMgfHwgW10pIHtcbiAgICAgIGF3YWl0IGZuKHtcbiAgICAgICAgaXNTdWNjZXNzOiB0cnVlLFxuICAgICAgICBpc0Vycm9yOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgYXJncyxcbiAgICAgICAgZGF0YVxuICAgICAgfSk7XG4gICAgICB0aGlzLmNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKTtcbiAgICB9XG4gIH1cbiAgLyoqIGhlbHBlciBmdW5jdGlvbiB0byBoYW5kbGUgZXJyb3JzIHdpdGggdGltZW91dCBjaGVja3BvaW50cyAqL1xuICBhc3luYyBoYW5kbGVFcnJvcihlcnIsIGlucHV0UmF3LCBpbnB1dFBhcnNlZCkge1xuICAgIGlmIChlcnIubWVzc2FnZSA9PT0gXCJORVhUX1JFRElSRUNUXCIgfHwgZXJyLm1lc3NhZ2UgPT09IFwiTkVYVF9OT1RfRk9VTkRcIikge1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICBpZiAodGhpcy4kaW50ZXJuYWxzLmlzUHJvY2VkdXJlKVxuICAgICAgcmV0dXJuIFtudWxsLCBlcnJdO1xuICAgIGxldCBjdXN0b21FcnJvcjtcbiAgICBpZiAodGhpcy4kaW50ZXJuYWxzLnNoYXBlRXJyb3JGbnMgIT09IHZvaWQgMCkge1xuICAgICAgbGV0IGFjY0RhdGEgPSB2b2lkIDA7XG4gICAgICBmb3IgKGNvbnN0IGZuIG9mIHRoaXMuJGludGVybmFscy5zaGFwZUVycm9yRm5zKSB7XG4gICAgICAgIGFjY0RhdGEgPSBhd2FpdCBmbih7XG4gICAgICAgICAgZXJyLFxuICAgICAgICAgIHR5cGVkRGF0YToge1xuICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICAgICAgICAgICAgaW5wdXRQYXJzZUVycm9yczogZXJyIGluc3RhbmNlb2YgWlNBRXJyb3IgPyBlcnIuaW5wdXRQYXJzZUVycm9ycyA6IHZvaWQgMCxcbiAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgICAgICAgICAgIG91dHB1dFBhcnNlRXJyb3JzOiBlcnIgaW5zdGFuY2VvZiBaU0FFcnJvciA/IGVyci5vdXRwdXRQYXJzZUVycm9ycyA6IHZvaWQgMCxcbiAgICAgICAgICAgIGlucHV0UGFyc2VkLFxuICAgICAgICAgICAgaW5wdXRSYXdcbiAgICAgICAgICB9LFxuICAgICAgICAgIGN0eDogYWNjRGF0YVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGN1c3RvbUVycm9yID0gYWNjRGF0YTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3VzdG9tRXJyb3IgPSBlcnIgaW5zdGFuY2VvZiBaU0FFcnJvciA/IGVyciA6IG5ldyBaU0FFcnJvcihcIkVSUk9SXCIsIGVycik7XG4gICAgfVxuICAgIGZvciAoY29uc3QgZm4gb2YgdGhpcy4kaW50ZXJuYWxzLm9uRXJyb3JGbnMgfHwgW10pIHtcbiAgICAgIGF3YWl0IGZuKGN1c3RvbUVycm9yKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBmbiBvZiB0aGlzLiRpbnRlcm5hbHMub25Db21wbGV0ZUZucyB8fCBbXSkge1xuICAgICAgYXdhaXQgZm4oe1xuICAgICAgICBpc1N1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBpc0Vycm9yOiB0cnVlLFxuICAgICAgICBzdGF0dXM6IFwiZXJyb3JcIixcbiAgICAgICAgZXJyb3I6IGN1c3RvbUVycm9yXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHRoaXMuJGludGVybmFscy5zaGFwZUVycm9yRm5zICE9PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBbbnVsbCwgY3VzdG9tRXJyb3JdO1xuICAgIH1cbiAgICBjb25zdCBzdHJpbmdpZnlJZk5lZWRlZCA9IChkYXRhMikgPT4gdHlwZW9mIGRhdGEyID09PSBcInN0cmluZ1wiID8gZGF0YTIgOiBKU09OLnN0cmluZ2lmeShkYXRhMik7XG4gICAgbGV0IGZvcm1hdHRlZEVycm9ycztcbiAgICBsZXQgZmxhdHRlbmVkRXJyb3JzO1xuICAgIGNvbnN0IGRhdGEgPSBlcnIuZGF0YTtcbiAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIHoyLlpvZEVycm9yICYmIGN1c3RvbUVycm9yLmNvZGUgPT09IFwiSU5QVVRfUEFSU0VfRVJST1JcIikge1xuICAgICAgZm9ybWF0dGVkRXJyb3JzID0gZGF0YS5mb3JtYXQoKTtcbiAgICAgIGZsYXR0ZW5lZEVycm9ycyA9IGRhdGEuZmxhdHRlbigpO1xuICAgIH1cbiAgICByZXR1cm4gW1xuICAgICAgbnVsbCxcbiAgICAgIHtcbiAgICAgICAgZGF0YTogc3RyaW5naWZ5SWZOZWVkZWQoY3VzdG9tRXJyb3IuZGF0YSksXG4gICAgICAgIG5hbWU6IGN1c3RvbUVycm9yLm5hbWUsXG4gICAgICAgIG1lc3NhZ2U6IHN0cmluZ2lmeUlmTmVlZGVkKGN1c3RvbUVycm9yLm1lc3NhZ2UpLFxuICAgICAgICBjb2RlOiBjdXN0b21FcnJvci5jb2RlLFxuICAgICAgICBmaWVsZEVycm9yczogZmxhdHRlbmVkRXJyb3JzPy5maWVsZEVycm9ycyxcbiAgICAgICAgZm9ybUVycm9yczogZmxhdHRlbmVkRXJyb3JzPy5mb3JtRXJyb3JzLFxuICAgICAgICBmb3JtYXR0ZWRFcnJvcnNcbiAgICAgIH1cbiAgICBdO1xuICB9XG4gIGFzeW5jIGV2YWx1YXRlSW5wdXRTY2hlbWEoYXJncykge1xuICAgIGNvbnN0IHsgY3R4LCBvcHRzLCBub0Z1bmN0aW9uc0FsbG93ZWQgfSA9IGFyZ3M7XG4gICAgbGV0IGlucHV0U2NoZW1hID0gdGhpcy4kaW50ZXJuYWxzLmlucHV0U2NoZW1hO1xuICAgIGlmIChub0Z1bmN0aW9uc0FsbG93ZWQgJiYgdHlwZW9mIGlucHV0U2NoZW1hID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIklucHV0IGZ1bmN0aW9ucyBhcmUgbm90IHN1cHBwb3J0ZWQgeWV0XCIpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGlucHV0U2NoZW1hID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIGlucHV0U2NoZW1hID0gYXdhaXQgaW5wdXRTY2hlbWEoe1xuICAgICAgICBjdHgsXG4gICAgICAgIHByZXZpb3VzU2NoZW1hOiBvcHRzPy5wcmV2aW91c0lucHV0U2NoZW1hIHx8IHoyLnVuZGVmaW5lZCgpLFxuICAgICAgICByZXF1ZXN0OiBvcHRzPy5yZXF1ZXN0LFxuICAgICAgICByZXNwb25zZU1ldGE6IG9wdHM/LnJlc3BvbnNlTWV0YSxcbiAgICAgICAgcHJldmlvdXNTdGF0ZTogb3B0cz8ucHJldmlvdXNTdGF0ZVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChpbnB1dFNjaGVtYSAmJiAhKGlucHV0U2NoZW1hIGluc3RhbmNlb2YgejIuWm9kVHlwZSkpIHtcbiAgICAgIHRocm93IG5ldyBaU0FFcnJvcihcIkVSUk9SXCIsIFwiSW5wdXQgc2NoZW1hIG11c3QgYmUgYSBab2RUeXBlXCIpO1xuICAgIH1cbiAgICBsZXQgZmluYWw7XG4gICAgaWYgKCFvcHRzPy5wcmV2aW91c0lucHV0U2NoZW1hKSB7XG4gICAgICBmaW5hbCA9IGlucHV0U2NoZW1hO1xuICAgIH0gZWxzZSBpZiAoIWlucHV0U2NoZW1hKSB7XG4gICAgICBmaW5hbCA9IG9wdHMucHJldmlvdXNJbnB1dFNjaGVtYTtcbiAgICB9IGVsc2UgaWYgKGluc3RhbmNlb2Zab2RUeXBlT2JqZWN0KG9wdHMucHJldmlvdXNJbnB1dFNjaGVtYSkgJiYgaW5zdGFuY2VvZlpvZFR5cGVPYmplY3QoaW5wdXRTY2hlbWEpKSB7XG4gICAgICBmaW5hbCA9IG9wdHMucHJldmlvdXNJbnB1dFNjaGVtYS5tZXJnZShpbnB1dFNjaGVtYSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZpbmFsID0gaW5wdXRTY2hlbWE7XG4gICAgfVxuICAgIG9wdHM/Lm9uSW5wdXRTY2hlbWE/LihmaW5hbCk7XG4gICAgcmV0dXJuIGZpbmFsIHx8IHoyLnVuZGVmaW5lZCgpO1xuICB9XG4gIC8qKiBoZWxwZXIgZnVuY3Rpb24gdG8gcGFyc2UgaW5wdXQgZGF0YSBnaXZlbiB0aGUgYWN0aXZlIGlucHV0IHNjaGVtYSAqL1xuICBhc3luYyBwYXJzZUlucHV0RGF0YSgkZGF0YSwgb3ZlcnJpZGVEYXRhLCB0aW1lb3V0U3RhdHVzLCBjdHgsIG9wdHMpIHtcbiAgICB0aGlzLmNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKTtcbiAgICBjb25zdCBpbnB1dFNjaGVtYSA9IGF3YWl0IHRoaXMuZXZhbHVhdGVJbnB1dFNjaGVtYSh7XG4gICAgICBjdHgsXG4gICAgICBvcHRzXG4gICAgfSk7XG4gICAgbGV0IGRhdGEgPSAkZGF0YTtcbiAgICBpZiAoJGRhdGEgaW5zdGFuY2VvZiBGb3JtRGF0YSAmJiB0aGlzLiRpbnRlcm5hbHMuaW5wdXRUeXBlICE9PSBcImpzb25cIikge1xuICAgICAgZGF0YSA9IHtcbiAgICAgICAgLi4uZm9ybURhdGFUb0pzb24oZGF0YSwgaW5wdXRTY2hlbWEpLFxuICAgICAgICAuLi50aGlzLiRpbnRlcm5hbHMuaW5wdXRUeXBlICE9PSBcInN0YXRlXCIgPyBvdmVycmlkZURhdGEgfHwge30gOiB7fVxuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgY2FuQ2hhbmdlVG9VbmRlZmluZWQgPSAoJGRhdGEgaW5zdGFuY2VvZiBGb3JtRGF0YSB8fCBvcHRzPy5pc0Zyb21PcGVuQXBpSGFuZGxlcikgJiYgY2FuRGF0YUJlVW5kZWZpbmVkRm9yU2NoZW1hKGlucHV0U2NoZW1hKTtcbiAgICBpZiAoY2FuQ2hhbmdlVG9VbmRlZmluZWQgJiYgZGF0YSAmJiB0eXBlb2YgZGF0YSA9PT0gXCJvYmplY3RcIiAmJiBPYmplY3Qua2V5cyhkYXRhKS5sZW5ndGggPT09IDApIHtcbiAgICAgIGRhdGEgPSB2b2lkIDA7XG4gICAgfVxuICAgIG9wdHM/Lm9uQXJncz8uKGRhdGEpO1xuICAgIGF3YWl0IHRoaXMuaGFuZGxlU3RhcnQoZGF0YSwgdGltZW91dFN0YXR1cyk7XG4gICAgaWYgKCF0aGlzLiRpbnRlcm5hbHMuaW5wdXRTY2hlbWEgJiYgZGF0YSAhPT0gdm9pZCAwICYmIHRoaXMuJGludGVybmFscy5pc1Byb2NlZHVyZSkge1xuICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICB9XG4gICAgY29uc3Qgc2FmZSA9IGF3YWl0IGlucHV0U2NoZW1hLnNhZmVQYXJzZUFzeW5jKGRhdGEpO1xuICAgIGlmICghc2FmZS5zdWNjZXNzKSB7XG4gICAgICBpZiAodGhpcy4kaW50ZXJuYWxzLm9uSW5wdXRQYXJzZUVycm9yKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuJGludGVybmFscy5vbklucHV0UGFyc2VFcnJvcihzYWZlLmVycm9yKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZsYXR0ZW5lZEVycm9ycyA9IHNhZmUuZXJyb3IuZmxhdHRlbigpO1xuICAgICAgY29uc3QgZm9ybWF0dGVkRXJyb3JzID0gc2FmZS5lcnJvci5mb3JtYXQoKTtcbiAgICAgIHRocm93IG5ldyBaU0FFcnJvcihcIklOUFVUX1BBUlNFX0VSUk9SXCIsIHNhZmUuZXJyb3IsIHtcbiAgICAgICAgaW5wdXRQYXJzZUVycm9yczoge1xuICAgICAgICAgIGZpZWxkRXJyb3JzOiBmbGF0dGVuZWRFcnJvcnM/LmZpZWxkRXJyb3JzLFxuICAgICAgICAgIGZvcm1FcnJvcnM6IGZsYXR0ZW5lZEVycm9ycz8uZm9ybUVycm9ycyxcbiAgICAgICAgICBmb3JtYXR0ZWRFcnJvcnNcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBzYWZlLmRhdGE7XG4gIH1cbiAgLyoqIHNldCBhIGhhbmRsZXIgZnVuY3Rpb24gZm9yIHdoZW4gdGhlIHNlcnZlciBhY3Rpb24gc3RhcnRzICovXG4gIGV4cGVyaW1lbnRhbF9zaGFwZUVycm9yKGZuKSB7XG4gICAgcmV0dXJuIG5ldyBfWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICAgIC4uLnRoaXMuJGludGVybmFscyxcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgICAgIHNoYXBlRXJyb3JGbnM6IFsuLi50aGlzLiRpbnRlcm5hbHMuc2hhcGVFcnJvckZucyB8fCBbXSwgZm5dXG4gICAgfSk7XG4gIH1cbiAgZ2V0VGltZW91dEVycm9yUHJvbWlzZSA9ICh0aW1lb3V0TXMpID0+IG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHJlamVjdChuZXcgWlNBRXJyb3IoXCJUSU1FT1VUXCIsIGBFeGNlZWRlZCB0aW1lb3V0IG9mICR7dGltZW91dE1zfSBtc2ApKTtcbiAgICB9LCB0aW1lb3V0TXMpO1xuICB9KTtcbiAgLyoqIHNldCB0aGUgaGFuZGxlciBmdW5jdGlvbiBmb3IgdGhlIHNlcnZlciBhY3Rpb24gKi9cbiAgaGFuZGxlcihmbikge1xuICAgIGNvbnN0IHRpbWVvdXRTdGF0dXMgPSB7XG4gICAgICBpc1RpbWVvdXQ6IGZhbHNlXG4gICAgfTtcbiAgICBjb25zdCB3cmFwcGVyID0gYXN5bmMgKCRhcmdzLCBvdmVycmlkZUFyZ3MsIG9wdHMpID0+IHtcbiAgICAgIHZhbGlkYXRlT3B0cyhvcHRzKTtcbiAgICAgIGlmIChvcHRzPy5yZXR1cm5JbnB1dFNjaGVtYSkge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRGaW5hbFN0YXRpY0lucHV0U2NoZW1hKHtcbiAgICAgICAgICBvcHRzXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmIChvcHRzPy5yZXR1cm5PdXRwdXRTY2hlbWEpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLiRpbnRlcm5hbHMub3V0cHV0U2NoZW1hID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBcIkNhbm5vdCByZXR1cm4gb3V0cHV0IHNjaGVtYSBmcm9tIGEgZnVuY3Rpb24gb3V0cHV0IHNjaGVtYVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy4kaW50ZXJuYWxzLm91dHB1dFNjaGVtYTtcbiAgICAgIH1cbiAgICAgIGxldCBhcmdzO1xuICAgICAgbGV0IHBhcnNlZEFyZ3M7XG4gICAgICBpZiAodGhpcy4kaW50ZXJuYWxzLmlucHV0VHlwZSA9PT0gXCJzdGF0ZVwiKSB7XG4gICAgICAgIGFyZ3MgPSBvdmVycmlkZUFyZ3M7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhcmdzID0gJGFyZ3M7XG4gICAgICB9XG4gICAgICBsZXQgcHJldmlvdXNTdGF0ZSA9IG9wdHM/LnByZXZpb3VzU3RhdGUgfHwgdm9pZCAwO1xuICAgICAgaWYgKHRoaXMuJGludGVybmFscy5pbnB1dFR5cGUgPT09IFwic3RhdGVcIiAmJiAhdGhpcy4kaW50ZXJuYWxzLmlzUHJvY2VkdXJlKSB7XG4gICAgICAgIHByZXZpb3VzU3RhdGUgPSAkYXJncztcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCBjdHg7XG4gICAgICAgIGlmICh0aGlzLiRpbnRlcm5hbHMuaXNQcm9jZWR1cmUgJiYgb3B0cykge1xuICAgICAgICAgIGN0eCA9IG9wdHMuY3R4O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGN0eCA9IGF3YWl0IHRoaXMuZ2V0UHJvY2VkdXJlQ2hhaW5PdXRwdXQoe1xuICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICAgICAgICAgICAgYXJncyxcbiAgICAgICAgICAgIHRpbWVvdXRTdGF0dXMsXG4gICAgICAgICAgICByZXF1ZXN0OiBvcHRzPy5yZXF1ZXN0LFxuICAgICAgICAgICAgcmVzcG9uc2VNZXRhOiBvcHRzPy5yZXNwb25zZU1ldGEsXG4gICAgICAgICAgICBvbklucHV0U2NoZW1hOiAoc2NoZW1hKSA9PiB7XG4gICAgICAgICAgICAgIGlmICghb3B0cykge1xuICAgICAgICAgICAgICAgIG9wdHMgPSB7XG4gICAgICAgICAgICAgICAgICBzb3VyY2U6IG5ldyBUT3B0c1NvdXJjZSgoKSA9PiB0cnVlKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgb3B0cy5wcmV2aW91c0lucHV0U2NoZW1hID0gc2NoZW1hO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHByZXZpb3VzU3RhdGVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbnB1dCA9IGF3YWl0IHRoaXMucGFyc2VJbnB1dERhdGEoXG4gICAgICAgICAgYXJncyxcbiAgICAgICAgICBvdmVycmlkZUFyZ3MsXG4gICAgICAgICAgdGltZW91dFN0YXR1cyxcbiAgICAgICAgICBjdHgsXG4gICAgICAgICAgb3B0c1xuICAgICAgICApO1xuICAgICAgICBvcHRzPy5vblBhcnNlZEFyZ3M/LihpbnB1dCk7XG4gICAgICAgIHBhcnNlZEFyZ3MgPSBpbnB1dDtcbiAgICAgICAgdGhpcy5jaGVja1RpbWVvdXRTdGF0dXModGltZW91dFN0YXR1cyk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBmbih7XG4gICAgICAgICAgaW5wdXQsXG4gICAgICAgICAgY3R4LFxuICAgICAgICAgIHJlcXVlc3Q6IG9wdHM/LnJlcXVlc3QsXG4gICAgICAgICAgcmVzcG9uc2VNZXRhOiBvcHRzPy5yZXNwb25zZU1ldGEsXG4gICAgICAgICAgcHJldmlvdXNTdGF0ZVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcGFyc2VkID0gYXdhaXQgdGhpcy5wYXJzZU91dHB1dERhdGEoXG4gICAgICAgICAgZGF0YSxcbiAgICAgICAgICBjdHgsXG4gICAgICAgICAgdGltZW91dFN0YXR1cyxcbiAgICAgICAgICBvcHRzXG4gICAgICAgICk7XG4gICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlU3VjY2VzcyhpbnB1dCwgcGFyc2VkLCB0aW1lb3V0U3RhdHVzKTtcbiAgICAgICAgcmV0dXJuIFtwYXJzZWQsIG51bGxdO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnN0IHJldHJ5RGVsYXkgPSB0aGlzLmdldFJldHJ5RGVsYXkoZXJyLCBvcHRzPy5hdHRlbXB0cyB8fCAxKTtcbiAgICAgICAgaWYgKHJldHJ5RGVsYXkgPj0gMCkge1xuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyKSA9PiBzZXRUaW1lb3V0KHIsIHJldHJ5RGVsYXkpKTtcbiAgICAgICAgICByZXR1cm4gYXdhaXQgd3JhcHBlcigkYXJncywgb3ZlcnJpZGVBcmdzLCB7XG4gICAgICAgICAgICAuLi5vcHRzIHx8IHt9LFxuICAgICAgICAgICAgYXR0ZW1wdHM6IChvcHRzPy5hdHRlbXB0cyB8fCAxKSArIDEsXG4gICAgICAgICAgICBzb3VyY2U6IG5ldyBUT3B0c1NvdXJjZSgoKSA9PiB0cnVlKVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmhhbmRsZUVycm9yKGVyciwgYXJncywgcGFyc2VkQXJncyk7XG4gICAgICB9XG4gICAgfTtcbiAgICBjb25zdCB3aXRoVGltZW91dCA9IGFzeW5jIChhcmdzLCBvdmVycmlkZUFyZ3MsIG9wdHMpID0+IHtcbiAgICAgIGNvbnN0IHRpbWVvdXRNcyA9IHRoaXMuJGludGVybmFscy50aW1lb3V0O1xuICAgICAgaWYgKCF0aW1lb3V0TXMpXG4gICAgICAgIHJldHVybiBhd2FpdCB3cmFwcGVyKGFyZ3MsIG92ZXJyaWRlQXJncywgb3B0cyk7XG4gICAgICB2YWxpZGF0ZU9wdHMob3B0cyk7XG4gICAgICBsZXQgZ290QXJncyA9IHZvaWQgMDtcbiAgICAgIGxldCBnb3RQYXJzZWRBcmdzID0gdm9pZCAwO1xuICAgICAgcmV0dXJuIGF3YWl0IFByb21pc2UucmFjZShbXG4gICAgICAgIHdyYXBwZXIoYXJncywgb3ZlcnJpZGVBcmdzLCB7XG4gICAgICAgICAgLi4ub3B0cyB8fCB7fSxcbiAgICAgICAgICBvbkFyZ3M6IChhcmdzMikgPT4ge1xuICAgICAgICAgICAgZ290QXJncyA9IGFyZ3MyO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25QYXJzZWRBcmdzOiAocGFyc2VkQXJncykgPT4ge1xuICAgICAgICAgICAgZ290UGFyc2VkQXJncyA9IHBhcnNlZEFyZ3M7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzb3VyY2U6IG5ldyBUT3B0c1NvdXJjZSgoKSA9PiB0cnVlKVxuICAgICAgICB9KSxcbiAgICAgICAgdGhpcy5nZXRUaW1lb3V0RXJyb3JQcm9taXNlKHRpbWVvdXRNcylcbiAgICAgIF0pLnRoZW4oKHIpID0+IHIpLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgdGltZW91dFN0YXR1cy5pc1RpbWVvdXQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVFcnJvcihlcnIsIGdvdEFyZ3MsIGdvdFBhcnNlZEFyZ3MpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICBpZiAodGhpcy4kaW50ZXJuYWxzLmlzUHJvY2VkdXJlKSB7XG4gICAgICBjb25zdCBoYW5kbGVyID0gdGhpcy4kaW50ZXJuYWxzLnRpbWVvdXQgPyB3aXRoVGltZW91dCA6IHdyYXBwZXI7XG4gICAgICByZXR1cm4gbmV3IENvbXBsZXRlUHJvY2VkdXJlKHtcbiAgICAgICAgaW5wdXRTY2hlbWE6IHRoaXMuJGludGVybmFscy5pbnB1dFNjaGVtYSxcbiAgICAgICAgaGFuZGxlckNoYWluOiBbLi4udGhpcy4kaW50ZXJuYWxzLnByb2NlZHVyZUhhbmRsZXJDaGFpbiwgaGFuZGxlcl0sXG4gICAgICAgIHNoYXBlRXJyb3JGbnM6IHRoaXMuJGludGVybmFscy5zaGFwZUVycm9yRm5zLFxuICAgICAgICBsYXN0SGFuZGxlcjogaGFuZGxlcixcbiAgICAgICAgb25Db21wbGV0ZUZuczogdGhpcy4kaW50ZXJuYWxzLm9uQ29tcGxldGVGbnMsXG4gICAgICAgIG9uRXJyb3JGbnM6IHRoaXMuJGludGVybmFscy5vbkVycm9yRm5zLFxuICAgICAgICBvblN0YXJ0Rm5zOiB0aGlzLiRpbnRlcm5hbHMub25TdGFydEZucyxcbiAgICAgICAgb25TdWNjZXNzRm5zOiB0aGlzLiRpbnRlcm5hbHMub25TdWNjZXNzRm5zLFxuICAgICAgICB0aW1lb3V0OiB0aGlzLiRpbnRlcm5hbHMudGltZW91dCxcbiAgICAgICAgcmV0cnlDb25maWc6IHRoaXMuJGludGVybmFscy5yZXRyeUNvbmZpZ1xuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICh0aGlzLiRpbnRlcm5hbHMudGltZW91dCkge1xuICAgICAgcmV0dXJuIHdpdGhUaW1lb3V0O1xuICAgIH1cbiAgICByZXR1cm4gd3JhcHBlcjtcbiAgfVxufTtcbmZ1bmN0aW9uIGNyZWF0ZVpvZFNhZmVGdW5jdGlvbihpc1Byb2NlZHVyZSwgcGFyZW50UHJvY2VkdXJlKSB7XG4gIHJldHVybiBuZXcgWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICBpbnB1dFNjaGVtYTogcGFyZW50UHJvY2VkdXJlPy4kaW50ZXJuYWxzLmlucHV0U2NoZW1hIHx8IHZvaWQgMCxcbiAgICBvdXRwdXRTY2hlbWE6IHZvaWQgMCxcbiAgICBzaGFwZUVycm9yRm5zOiBwYXJlbnRQcm9jZWR1cmU/LiRpbnRlcm5hbHMuc2hhcGVFcnJvckZucyB8fCB2b2lkIDAsXG4gICAgaXNDaGFpbmVkOiBwYXJlbnRQcm9jZWR1cmUgIT09IHZvaWQgMCxcbiAgICBpc1Byb2NlZHVyZTogaXNQcm9jZWR1cmUgPT09IHRydWUsXG4gICAgcHJvY2VkdXJlSGFuZGxlckNoYWluOiBwYXJlbnRQcm9jZWR1cmU/LiRpbnRlcm5hbHMuaGFuZGxlckNoYWluIHx8IFtdLFxuICAgIG9uQ29tcGxldGVGbnM6IHBhcmVudFByb2NlZHVyZT8uJGludGVybmFscy5vbkNvbXBsZXRlRm5zLFxuICAgIG9uRXJyb3JGbnM6IHBhcmVudFByb2NlZHVyZT8uJGludGVybmFscy5vbkVycm9yRm5zLFxuICAgIG9uU3RhcnRGbnM6IHBhcmVudFByb2NlZHVyZT8uJGludGVybmFscy5vblN0YXJ0Rm5zLFxuICAgIG9uU3VjY2Vzc0ZuczogcGFyZW50UHJvY2VkdXJlPy4kaW50ZXJuYWxzLm9uU3VjY2Vzc0Zuc1xuICB9KTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZVNlcnZlckFjdGlvbigpIHtcbiAgcmV0dXJuIG5ldyBab2RTYWZlRnVuY3Rpb24oe1xuICAgIGlucHV0U2NoZW1hOiB2b2lkIDAsXG4gICAgb3V0cHV0U2NoZW1hOiB2b2lkIDAsXG4gICAgc2hhcGVFcnJvckZuczogdm9pZCAwLFxuICAgIHByb2NlZHVyZUhhbmRsZXJDaGFpbjogW11cbiAgfSk7XG59XG5cbi8vIHNyYy9wcm9jZWR1cmUudHNcbnZhciBDb21wbGV0ZVByb2NlZHVyZSA9IGNsYXNzIHtcbiAgJGludGVybmFscztcbiAgY29uc3RydWN0b3IocGFyYW1zKSB7XG4gICAgdGhpcy4kaW50ZXJuYWxzID0gcGFyYW1zO1xuICB9XG4gIC8qKiBtYWtlIGEgc2VydmVyIGFjdGlvbiB3aXRoIHRoZSBjdXJyZW50IHByb2NlZHVyZSAqL1xuICBjcmVhdGVTZXJ2ZXJBY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgaW5wdXRTY2hlbWE6IHRoaXMuJGludGVybmFscy5pbnB1dFNjaGVtYSxcbiAgICAgIG91dHB1dFNjaGVtYTogdm9pZCAwLFxuICAgICAgcHJvY2VkdXJlSGFuZGxlckNoYWluOiB0aGlzLiRpbnRlcm5hbHMuaGFuZGxlckNoYWluLFxuICAgICAgb25FcnJvckZuczogdGhpcy4kaW50ZXJuYWxzLm9uRXJyb3JGbnMsXG4gICAgICBvblN0YXJ0Rm5zOiB0aGlzLiRpbnRlcm5hbHMub25TdGFydEZucyxcbiAgICAgIG9uU3VjY2Vzc0ZuczogdGhpcy4kaW50ZXJuYWxzLm9uU3VjY2Vzc0ZucyxcbiAgICAgIG9uQ29tcGxldGVGbnM6IHRoaXMuJGludGVybmFscy5vbkNvbXBsZXRlRm5zLFxuICAgICAgdGltZW91dDogdGhpcy4kaW50ZXJuYWxzLnRpbWVvdXQsXG4gICAgICByZXRyeUNvbmZpZzogdGhpcy4kaW50ZXJuYWxzLnJldHJ5Q29uZmlnLFxuICAgICAgc2hhcGVFcnJvckZuczogdGhpcy4kaW50ZXJuYWxzLnNoYXBlRXJyb3JGbnNcbiAgICB9KTtcbiAgfVxufTtcbnZhciBjcmVhdGVTZXJ2ZXJBY3Rpb25Qcm9jZWR1cmUgPSAocGFyZW50KSA9PiB7XG4gIHJldHVybiBjcmVhdGVab2RTYWZlRnVuY3Rpb24odHJ1ZSwgcGFyZW50KTtcbn07XG52YXIgY2hhaW5TZXJ2ZXJBY3Rpb25Qcm9jZWR1cmVzID0gKGZpcnN0LCBzZWNvbmQpID0+IHtcbiAgcmV0dXJuIG5ldyBDb21wbGV0ZVByb2NlZHVyZSh7XG4gICAgaW5wdXRTY2hlbWE6IHNlY29uZC4kaW50ZXJuYWxzLmlucHV0U2NoZW1hLFxuICAgIGhhbmRsZXJDaGFpbjogW1xuICAgICAgLi4uZmlyc3QuJGludGVybmFscy5oYW5kbGVyQ2hhaW4sXG4gICAgICBzZWNvbmQuJGludGVybmFscy5sYXN0SGFuZGxlclxuICAgIF0sXG4gICAgbGFzdEhhbmRsZXI6IHNlY29uZC4kaW50ZXJuYWxzLmxhc3RIYW5kbGVyLFxuICAgIHRpbWVvdXQ6IHNlY29uZC4kaW50ZXJuYWxzLnRpbWVvdXQgfHwgZmlyc3QuJGludGVybmFscy50aW1lb3V0LFxuICAgIHJldHJ5Q29uZmlnOiBzZWNvbmQuJGludGVybmFscy5yZXRyeUNvbmZpZyB8fCBmaXJzdC4kaW50ZXJuYWxzLnJldHJ5Q29uZmlnLFxuICAgIHNoYXBlRXJyb3JGbnM6IG1lcmdlQXJyYXlzQW5kUmVtb3ZlRHVwbGljYXRlcyhcbiAgICAgIGZpcnN0LiRpbnRlcm5hbHMuc2hhcGVFcnJvckZucyxcbiAgICAgIHNlY29uZC4kaW50ZXJuYWxzLnNoYXBlRXJyb3JGbnNcbiAgICApLFxuICAgIG9uRXJyb3JGbnM6IG1lcmdlQXJyYXlzQW5kUmVtb3ZlRHVwbGljYXRlcyhcbiAgICAgIGZpcnN0LiRpbnRlcm5hbHMub25FcnJvckZucyxcbiAgICAgIHNlY29uZC4kaW50ZXJuYWxzLm9uRXJyb3JGbnNcbiAgICApLFxuICAgIG9uU3RhcnRGbnM6IG1lcmdlQXJyYXlzQW5kUmVtb3ZlRHVwbGljYXRlcyhcbiAgICAgIGZpcnN0LiRpbnRlcm5hbHMub25TdGFydEZucyxcbiAgICAgIHNlY29uZC4kaW50ZXJuYWxzLm9uU3RhcnRGbnNcbiAgICApLFxuICAgIG9uU3VjY2Vzc0ZuczogbWVyZ2VBcnJheXNBbmRSZW1vdmVEdXBsaWNhdGVzKFxuICAgICAgZmlyc3QuJGludGVybmFscy5vblN1Y2Nlc3NGbnMsXG4gICAgICBzZWNvbmQuJGludGVybmFscy5vblN1Y2Nlc3NGbnNcbiAgICApLFxuICAgIG9uQ29tcGxldGVGbnM6IG1lcmdlQXJyYXlzQW5kUmVtb3ZlRHVwbGljYXRlcyhcbiAgICAgIGZpcnN0LiRpbnRlcm5hbHMub25Db21wbGV0ZUZucyxcbiAgICAgIHNlY29uZC4kaW50ZXJuYWxzLm9uQ29tcGxldGVGbnNcbiAgICApXG4gIH0pO1xufTtcbmV4cG9ydCB7XG4gIENvbXBsZXRlUHJvY2VkdXJlLFxuICBEZWZhdWx0T21pdHRlZCxcbiAgU2hhcGVFcnJvck5vdFNldCxcbiAgVE9wdHNTb3VyY2UsXG4gIFpTQUVycm9yLFxuICBaU0FSZXNwb25zZU1ldGEsXG4gIFpvZFNhZmVGdW5jdGlvbixcbiAgYWRkVG9OdWxsaXNoQXJyYXksXG4gIGNhbkRhdGFCZVVuZGVmaW5lZEZvclNjaGVtYSxcbiAgY2hhaW5TZXJ2ZXJBY3Rpb25Qcm9jZWR1cmVzLFxuICBjcmVhdGVTZXJ2ZXJBY3Rpb24sXG4gIGNyZWF0ZVNlcnZlckFjdGlvblByb2NlZHVyZSxcbiAgY3JlYXRlWm9kU2FmZUZ1bmN0aW9uLFxuICBmb3JtRGF0YVRvSnNvbixcbiAgaW5zdGFuY2VvZlpvZFR5cGVBcnJheSxcbiAgaW5zdGFuY2VvZlpvZFR5cGVCb29sZWFuLFxuICBpbnN0YW5jZW9mWm9kVHlwZUtpbmQsXG4gIGluc3RhbmNlb2Zab2RUeXBlTGlrZVZvaWQsXG4gIGluc3RhbmNlb2Zab2RUeXBlT2JqZWN0LFxuICBpc0tleUFCb29sZWFuSW5ab2RTY2hlbWEsXG4gIGlzS2V5QW5BcnJheUluWm9kU2NoZW1hLFxuICBtZXJnZUFycmF5c0FuZFJlbW92ZUR1cGxpY2F0ZXMsXG4gIHVud3JhcFpvZFR5cGVcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/./node_modules/zsa/dist/index.mjs\n");

/***/ })

};
;